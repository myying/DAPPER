



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Admin - DAPPER</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#4cae4f">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-dapperadmin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="DAPPER" class="md-header-nav__button md-logo" aria-label="DAPPER">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            DAPPER
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Admin
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/nansencenter/DAPPER/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DAPPER
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DAPPER" class="md-nav__button md-logo" aria-label="DAPPER">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DAPPER
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/nansencenter/DAPPER/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    DAPPER
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      Dapper
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Dapper" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon"></span>
        Dapper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Admin
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Admin" class="md-nav__link md-nav__link--active">
      Admin
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#da_method" class="md-nav__link">
    da_method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_param_setter" class="md-nav__link">
    get_param_setter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_experiment" class="md-nav__link">
    run_experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seed_and_simulate" class="md-nav__link">
    seed_and_simulate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hiddenmarkovmodel" class="md-nav__link">
    HiddenMarkovModel
  </a>
  
    <nav class="md-nav" aria-label="HiddenMarkovModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate" class="md-nav__link">
    simulate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator" class="md-nav__link">
    Operator
  </a>
  
    <nav class="md-nav" aria-label="Operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xplist" class="md-nav__link">
    xpList
  </a>
  
    <nav class="md-nav" aria-label="xpList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append" class="md-nav__link">
    append
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend" class="md-nav__link">
    extend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gen_names" class="md-nav__link">
    gen_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inds" class="md-nav__link">
    inds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch" class="md-nav__link">
    launch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    remove
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse" class="md-nav__link">
    reverse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort" class="md-nav__link">
    sort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split_attrs" class="md-nav__link">
    split_attrs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tabulate_avrgs" class="md-nav__link">
    tabulate_avrgs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data_management/" title="Data Management" class="md-nav__link">
      Data Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dict_tools/" title="Dict Tools" class="md-nav__link">
      Dict Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dpr_config/" title="Dpr Config" class="md-nav__link">
      Dpr Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stats/" title="Stats" class="md-nav__link">
      Stats
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#da_method" class="md-nav__link">
    da_method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_param_setter" class="md-nav__link">
    get_param_setter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_experiment" class="md-nav__link">
    run_experiment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seed_and_simulate" class="md-nav__link">
    seed_and_simulate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hiddenmarkovmodel" class="md-nav__link">
    HiddenMarkovModel
  </a>
  
    <nav class="md-nav" aria-label="HiddenMarkovModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulate" class="md-nav__link">
    simulate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operator" class="md-nav__link">
    Operator
  </a>
  
    <nav class="md-nav" aria-label="Operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables_1" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xplist" class="md-nav__link">
    xpList
  </a>
  
    <nav class="md-nav" aria-label="xpList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav" aria-label="Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#append" class="md-nav__link">
    append
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear" class="md-nav__link">
    clear
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy" class="md-nav__link">
    copy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extend" class="md-nav__link">
    extend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gen_names" class="md-nav__link">
    gen_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inds" class="md-nav__link">
    inds
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch" class="md-nav__link">
    launch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    pop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    remove
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverse" class="md-nav__link">
    reverse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort" class="md-nav__link">
    sort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split_attrs" class="md-nav__link">
    split_attrs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tabulate_avrgs" class="md-nav__link">
    tabulate_avrgs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nansencenter/DAPPER/edit/master/reference/dapper/admin.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="module-dapperadmin">Module dapper.admin</h1>
<p>Define high-level API in DAPPER.</p>
<p>Used for experiment (xp) specification/administration, including:</p>
<ul>
<li>da_method decorator</li>
<li>xpList</li>
<li>save_data</li>
<li>run_experiment</li>
<li>
<p>run_from_file</p>
</li>
<li>
<p>HiddenMarkovModel</p>
</li>
<li>Operator</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Define high-level API in DAPPER.</span>

<span class="sd">Used for experiment (xp) specification/administration, including:</span>

<span class="sd"> - da_method decorator</span>

<span class="sd"> - xpList</span>

<span class="sd"> - save_data</span>

<span class="sd"> - run_experiment</span>

<span class="sd"> - run_from_file</span>

<span class="sd"> - HiddenMarkovModel</span>

<span class="sd"> - Operator</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">dapper.stats</span>

<span class="kn">import</span> <span class="nn">dapper.dict_tools</span> <span class="k">as</span> <span class="nn">dict_tools</span>

<span class="kn">from</span> <span class="nn">dapper.tools.chronos</span> <span class="kn">import</span> <span class="n">Chronology</span>

<span class="kn">from</span> <span class="nn">dapper.tools.randvars</span> <span class="kn">import</span> <span class="n">RV</span><span class="p">,</span> <span class="n">GaussRV</span>

<span class="kn">from</span> <span class="nn">dapper.tools.stoch</span> <span class="kn">import</span> <span class="n">set_seed</span>

<span class="kn">from</span> <span class="nn">dapper.dpr_config</span> <span class="kn">import</span> <span class="n">rc</span>

<span class="kn">from</span> <span class="nn">dapper.tools.remote.uplink</span> <span class="kn">import</span> <span class="n">submit_job_GCP</span>

<span class="kn">import</span> <span class="nn">dapper.tools.utils</span> <span class="k">as</span> <span class="nn">utils</span>

<span class="kn">from</span> <span class="nn">dapper.tools.localization</span> <span class="kn">import</span> <span class="n">no_localization</span>

<span class="kn">from</span> <span class="nn">dapper.tools.math</span> <span class="kn">import</span> <span class="n">Id_op</span><span class="p">,</span> <span class="n">Id_mat</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">dataclasses</span> <span class="k">as</span> <span class="nn">dcs</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">import</span> <span class="nn">dill</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">HiddenMarkovModel</span><span class="p">(</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">NicePrint</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Container for attributes of a Hidden Markov Model (HMM).</span>

<span class="sd">    This container contains the specification of a &quot;twin experiment&quot;,</span>

<span class="sd">    i.e. an &quot;OSSE (observing system simulation experiment)&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dyn</span><span class="p">,</span> <span class="n">Obs</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># fmt: off</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Dyn</span> <span class="o">=</span> <span class="n">Dyn</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Dyn</span><span class="p">,</span> <span class="n">Operator</span><span class="p">)</span>   <span class="k">else</span> <span class="n">Operator</span>  <span class="p">(</span><span class="o">**</span><span class="n">Dyn</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span> <span class="o">=</span> <span class="n">Obs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">Operator</span><span class="p">)</span>   <span class="k">else</span> <span class="n">Operator</span>  <span class="p">(</span><span class="o">**</span><span class="n">Obs</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span>   <span class="o">=</span> <span class="n">t</span>   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span>  <span class="p">,</span> <span class="n">Chronology</span><span class="p">)</span> <span class="k">else</span> <span class="n">Chronology</span><span class="p">(</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>   <span class="c1"># noqa</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X0</span>  <span class="o">=</span> <span class="n">X0</span>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X0</span> <span class="p">,</span> <span class="n">RV</span><span class="p">)</span>         <span class="k">else</span> <span class="n">RV</span>        <span class="p">(</span><span class="o">**</span><span class="n">X0</span><span class="p">)</span>  <span class="c1"># noqa</span>

        <span class="c1"># fmt: on</span>

        <span class="c1"># Name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">dapper</span><span class="o">/</span><span class="s1">&#39;mods&#39;</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># Kwargs</span>

        <span class="n">abbrevs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LP&#39;</span><span class="p">:</span> <span class="s1">&#39;liveplotters&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abbrevs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># Defaults</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="p">,</span> <span class="s2">&quot;localizer&quot;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="o">.</span><span class="n">localizer</span> <span class="o">=</span> <span class="n">no_localization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sectors&quot;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sectors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Validation</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">C</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">rk</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">M</span><span class="p">:</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Rank-deficient R not supported.&quot;</span><span class="p">)</span>

    <span class="c1"># ndim shortcuts</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">Nx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dyn</span><span class="o">.</span><span class="n">M</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">Ny</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="o">.</span><span class="n">M</span>

    <span class="n">printopts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ordering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Dyn&#39;</span><span class="p">,</span> <span class="s1">&#39;Obs&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;X0&#39;</span><span class="p">]}</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Truth &amp; Obs&#39;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Generate synthetic truth and observations.&quot;&quot;&quot;</span>

        <span class="n">Dyn</span><span class="p">,</span> <span class="n">Obs</span><span class="p">,</span> <span class="n">chrono</span><span class="p">,</span> <span class="n">X0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dyn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Obs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span>

        <span class="c1"># Init</span>

        <span class="n">xx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="o">.</span><span class="n">K</span>   <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Dyn</span><span class="o">.</span><span class="n">M</span><span class="p">))</span>

        <span class="n">yy</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="o">.</span><span class="n">KObs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Obs</span><span class="o">.</span><span class="n">M</span><span class="p">))</span>

        <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X0</span><span class="o">.</span><span class="kp">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Loop</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">kObs</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">progbar</span><span class="p">(</span><span class="n">chrono</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>

            <span class="n">xx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dyn</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="kp">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">Dyn</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="kp">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kObs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">yy</span><span class="p">[</span><span class="n">kObs</span><span class="p">]</span> <span class="o">=</span> <span class="n">Obs</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">Obs</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="kp">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span>

<span class="k">class</span> <span class="nc">Operator</span><span class="p">(</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">NicePrint</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Container for operators (models).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M</span>

        <span class="c1"># None =&gt; Identity model</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">model</span> <span class="o">=</span> <span class="n">Id_op</span><span class="p">()</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Id_mat</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># None/0 =&gt; No noise</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="kp">isscalar</span><span class="p">(</span><span class="n">noise</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">GaussRV</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">GaussRV</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>

        <span class="c1"># Write attributes</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">printopts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ordering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;noise&#39;</span><span class="p">]}</span>

<span class="k">def</span> <span class="nf">da_method</span><span class="p">(</span><span class="o">*</span><span class="n">default_dataclasses</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Make the decorator that makes the DA classes.</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; @da_method()</span>

<span class="sd">    &gt;&gt;&gt; class Sleeper():</span>

<span class="sd">    &gt;&gt;&gt;     &quot;Do nothing.&quot;</span>

<span class="sd">    &gt;&gt;&gt;     seconds : int  = 10</span>

<span class="sd">    &gt;&gt;&gt;     success : bool = True</span>

<span class="sd">    &gt;&gt;&gt;     def assimilate(self,*args,**kwargs):</span>

<span class="sd">    &gt;&gt;&gt;         for k in utils.progbar(range(self.seconds)):</span>

<span class="sd">    &gt;&gt;&gt;             time.sleep(1)</span>

<span class="sd">    &gt;&gt;&gt;         if not self.success:</span>

<span class="sd">    &gt;&gt;&gt;             raise RuntimeError(&quot;Sleep over. Failing as intended.&quot;)</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; @dcs.dataclass</span>

<span class="sd">    &gt;&gt;&gt; class ens_defaults:</span>

<span class="sd">    &gt;&gt;&gt;   infl : float = 1.0</span>

<span class="sd">    &gt;&gt;&gt;   rot  : bool  = False</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt; @da_method(ens_defaults)</span>

<span class="sd">    &gt;&gt;&gt; class EnKF:</span>

<span class="sd">    &gt;&gt;&gt;     N     : int</span>

<span class="sd">    &gt;&gt;&gt;     upd_a : str = &quot;Sqrt&quot;</span>

<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &gt;&gt;&gt;     def assimilate(self,HMM,xx,yy):</span>

<span class="sd">    &gt;&gt;&gt;         ...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">dataclass_with_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Decorator based on dataclass.</span>

<span class="sd">        This adds __init__, __repr__, __eq__, ..., but also includes</span>

<span class="sd">        inherited defaults (see https://stackoverflow.com/a/58130805 ).</span>

<span class="sd">        Also:</span>

<span class="sd">        - Wraps assimilate() to provide gentle_fail functionality.</span>

<span class="sd">        - Initialises and writes the Stats object.&quot;&quot;&quot;</span>

        <span class="c1"># Default fields invovle: (1) annotations and (2) attributes.</span>

        <span class="k">def</span> <span class="nf">set_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;__annotations__&#39;</span><span class="p">):</span>

                <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dcs</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                <span class="n">val</span> <span class="o">=</span> <span class="n">dcs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># APPend default fields without overwriting.</span>

        <span class="c1"># Don&#39;t implement (by PREpending?) non-default args -- to messy!</span>

        <span class="k">for</span> <span class="n">D</span> <span class="ow">in</span> <span class="n">default_dataclasses</span><span class="p">:</span>

            <span class="c1"># NB: Calling dataclass twice always makes repr=True, so avoid this.</span>

            <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="n">dcs</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">dcs</span><span class="o">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>

                <span class="k">if</span> <span class="n">F</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">:</span>

                    <span class="n">set_field</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>

        <span class="c1"># Create new class (NB: old/new classes have same id)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="n">dcs</span><span class="o">.</span><span class="n">dataclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Shortcut for self.__class__.__name__</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">da_method</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">def</span> <span class="nf">assimilate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">):</span>

            <span class="c1"># Progressbar name</span>

            <span class="n">pb_name_hook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">da_method</span> <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">desc</span> <span class="c1"># noqa</span>

            <span class="c1"># Init stats</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">dapper</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">)</span>

            <span class="c1"># Assimilate</span>

            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">old_assimilate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>

            <span class="n">dapper</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">register_stat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">time_start</span><span class="p">)</span>

        <span class="n">old_assimilate</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">assimilate</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">assimilate</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">old_assimilate</span><span class="p">)(</span><span class="n">assimilate</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">dataclass_with_defaults</span>

<span class="k">def</span> <span class="nf">seed_and_simulate</span><span class="p">(</span><span class="n">HMM</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Default experiment setup. Set seed and simulate truth and obs.</span>

<span class="sd">    Note: if there is no ``xp.seed`` then then the seed is not set.</span>

<span class="sd">    Thus, different experiments will produce different truth and obs.&quot;&quot;&quot;</span>

    <span class="n">set_seed</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">HMM</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span>

<span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">savedir</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span>

                   <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">free</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">statkeys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fail_gently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>

                   <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Used by xpList.launch() to run each single experiment.</span>

<span class="sd">    This involves steps similar to ``example_1.py``, i.e.:</span>

<span class="sd">    - setup()                    : Call function given by user. Should set</span>

<span class="sd">                                   params, eg HMM.Force, seed, and return</span>

<span class="sd">                                   (simulated/loaded) truth and obs series.</span>

<span class="sd">    - xp.assimilate()            : run DA, pass on exception if fail_gently</span>

<span class="sd">    - xp.stats.average_in_time() : result averaging</span>

<span class="sd">    - xp.avrgs.tabulate()        : result printing</span>

<span class="sd">    - dill.dump()                : result storage</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We should copy HMM so as not to cause any nasty surprises such as</span>

    <span class="c1"># expecting param=1 when param=2 (coz it&#39;s not been reset).</span>

    <span class="c1"># NB: won&#39;t copy implicitly ref&#39;d obj&#39;s (like L96&#39;s core). =&gt; bug w/ MP?</span>

    <span class="n">hmm</span> <span class="o">=</span> <span class="kp">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">HMM</span><span class="p">)</span>

    <span class="c1"># GENERATE TRUTH/OBS</span>

    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span>

    <span class="c1"># ASSIMILATE</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">xp</span><span class="o">.</span><span class="n">assimilate</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ERR</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">fail_gently</span><span class="p">:</span>

            <span class="n">xp</span><span class="o">.</span><span class="n">crashed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">fail_gently</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="s2">&quot;quiet&quot;</span><span class="p">]:</span>

                <span class="n">utils</span><span class="o">.</span><span class="n">print_cropped_traceback</span><span class="p">(</span><span class="n">ERR</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">raise</span> <span class="n">ERR</span>

    <span class="c1"># AVERAGE</span>

    <span class="n">xp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">average_in_time</span><span class="p">(</span><span class="n">free</span><span class="o">=</span><span class="n">free</span><span class="p">)</span>

    <span class="c1"># PRINT</span>

    <span class="k">if</span> <span class="n">statkeys</span><span class="p">:</span>

        <span class="n">statkeys</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">statkeys</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">statkeys</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">avrgs</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">statkeys</span><span class="p">))</span>

    <span class="c1"># SAVE</span>

    <span class="k">if</span> <span class="n">savedir</span><span class="p">:</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>

            <span class="n">dill</span><span class="o">.</span><span class="kp">dump</span><span class="p">({</span><span class="s1">&#39;xp&#39;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">FILE</span><span class="p">)</span>

<span class="c1"># TODO 2: check collections.userlist</span>

<span class="c1"># TODO 2: __add__ vs __iadd__</span>

<span class="k">class</span> <span class="nc">xpList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;List, subclassed for holding experiment (&quot;xp&quot;) objects.</span>

<span class="sd">    Main use: administrate experiment **launches**.</span>

<span class="sd">    Also see: ``xpSpace`` for experiment **result presentation**.</span>

<span class="sd">     Modifications to ``list``:</span>

<span class="sd">     - ``__iadd__`` (append) also for single items;</span>

<span class="sd">       this is hackey, but convenience is king.</span>

<span class="sd">     - ``append()`` supports ``unique`` to enable lazy xp declaration.</span>

<span class="sd">     - ``__getitem__`` supports lists.</span>

<span class="sd">     - pretty printing (using common/distinct attrs).</span>

<span class="sd">     Add-ons:</span>

<span class="sd">     - ``launch()``</span>

<span class="sd">     - ``print_averages()``</span>

<span class="sd">     - ``gen_names()``</span>

<span class="sd">     - ``inds()`` to search by kw-attrs.</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="kp">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Initialize without args, or with a list of configs.</span>

<span class="sd">        If ``unique``: duplicates won&#39;t get appended.</span>

<span class="sd">        This makes ``append()`` (and ``__iadd__()``) relatively slow.</span>

<span class="sd">        Use ``extend()`` or ``__add__()`` to bypass this validation.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="kp">unique</span> <span class="o">=</span> <span class="kp">unique</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="p">[</span><span class="n">xp</span><span class="p">]</span>

        <span class="k">for</span> <span class="kp">item</span> <span class="ow">in</span> <span class="n">xp</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="kp">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Append if not unique &amp; present.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="kp">unique</span> <span class="ow">and</span> <span class="n">xp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">):</span>

            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Indexing, also by a list&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>    <span class="c1"># if keys is list</span>

        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>

            <span class="n">B</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>  <span class="c1"># if keys is int, slice</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>

            <span class="n">B</span> <span class="o">=</span> <span class="n">xpList</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>                  <span class="c1"># Cast</span>

        <span class="k">return</span> <span class="n">B</span>

    <span class="k">def</span> <span class="nf">inds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">missingval</span><span class="o">=</span><span class="s2">&quot;NONSENSE&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Find (all) indices of configs whose attributes match kws.</span>

<span class="sd">        If strict, then xp&#39;s lacking a requested attr will not match,</span>

<span class="sd">        unless the missingval (e.g. None) matches the required value.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">xp</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">missing</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="n">missingval</span> <span class="k">if</span> <span class="n">strict</span> <span class="k">else</span> <span class="n">v</span>

            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">missing</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kws</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">xp</span><span class="p">)]</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">da_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">xp</span><span class="o">.</span><span class="n">da_method</span> <span class="k">for</span> <span class="n">xp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">split_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nomerge</span><span class="o">=</span><span class="p">()):</span>

        <span class="sd">&quot;&quot;&quot;Compile the attrs of all xps; split as distinct, redundant, common.</span>

<span class="sd">        Insert None if an attribute is distinct but not in xp.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_aggregate_keys</span><span class="p">():</span>

            <span class="s2">&quot;Aggregate keys from all xps&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Start with da_method</span>

            <span class="n">aggregate</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;da_method&#39;</span><span class="p">]</span>

            <span class="c1"># Aggregate all other keys</span>

            <span class="k">for</span> <span class="n">xp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>

                <span class="c1"># Get dataclass fields</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">dc_fields</span> <span class="o">=</span> <span class="n">dcs</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

                    <span class="n">dc_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">F</span> <span class="ow">in</span> <span class="n">dc_fields</span><span class="p">]</span>

                    <span class="n">keys</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>

                    <span class="c1"># Assume namedtuple</span>

                    <span class="n">dc_names</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="n">keys</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">_fields</span>

                <span class="c1"># For all potential keys:</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>

                    <span class="c1"># If not already present:</span>

                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aggregate</span><span class="p">:</span>

                        <span class="c1"># If dataclass, check repr:</span>

                        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dc_names</span><span class="p">:</span>

                            <span class="k">if</span> <span class="n">dc_fields</span><span class="p">[</span><span class="n">dc_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">.</span><span class="n">repr</span><span class="p">:</span>

                                <span class="n">aggregate</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

                        <span class="c1"># Else, just append</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="n">aggregate</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="c1"># Remove unwanted</span>

            <span class="n">excluded</span>  <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^_&#39;</span><span class="p">),</span> <span class="s1">&#39;avrgs&#39;</span><span class="p">,</span> <span class="s1">&#39;stats&#39;</span><span class="p">,</span> <span class="s1">&#39;HMM&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">]</span>

            <span class="n">aggregate</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="n">excluded</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">aggregate</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_aggregate_keys</span><span class="p">():</span>

            <span class="c1"># Want to distinguish actual None&#39;s from empty (&quot;N/A&quot;).</span>

            <span class="c1"># =&gt; Don&#39;t use getattr(obj,key,None)</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">xp</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

            <span class="c1"># Sort (assign dct) into distinct, redundant, common</span>

            <span class="k">if</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">flexcomp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">nomerge</span><span class="p">):</span>

                <span class="c1"># nomerge =&gt; Distinct</span>

                <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">vals</span>

            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>

                <span class="c1"># all values equal =&gt; common</span>

                <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">common</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">v0</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">if</span> <span class="s2">&quot;N/A&quot;</span> <span class="o">!=</span> <span class="n">v</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>

                    <span class="c1"># all values equal or &quot;N/A&quot; =&gt; redundant</span>

                    <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">v0</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># otherwise =&gt; distinct</span>

                    <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">vals</span>

            <span class="c1"># Replace &quot;N/A&quot; by None</span>

            <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span> <span class="k">else</span> <span class="n">v</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

                <span class="n">vals</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>

                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>

                    <span class="n">vals</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>

        <span class="k">return</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_attrs</span><span class="p">()</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&lt;xpList&gt; of length </span><span class="si">%d</span><span class="s1"> with attributes:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">distinct</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Other attributes:</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">AlignedDict</span><span class="p">({</span><span class="o">**</span><span class="n">redundant</span><span class="p">,</span> <span class="o">**</span><span class="n">common</span><span class="p">}))</span>

        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">gen_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abbrev</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Similiar to ``self.__repr__()``, but:</span>

<span class="sd">        - returns *list* of names</span>

<span class="sd">        - tabulation is optional</span>

<span class="sd">        - attaches (abbreviated) labels to each attribute</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_attrs</span><span class="p">(</span><span class="n">nomerge</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;da_method&quot;</span><span class="p">])</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">distinct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">distinct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="c1"># Label abbreviation</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">collapse_str</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">abbrev</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>

        <span class="c1"># Make label columns: insert None or lbl+&quot;:&quot;, depending on value</span>

        <span class="k">def</span> <span class="nf">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lbl</span><span class="o">+</span><span class="s2">&quot;:&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)]</span>

        <span class="c1"># Interlace labels and values</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>

        <span class="c1"># Rm da_method label (but keep value)</span>

        <span class="n">table</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Transpose</span>

        <span class="n">table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)))</span>

        <span class="c1"># Tabulate</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;plain&quot;</span><span class="p">)</span>

        <span class="c1"># Rm space between lbls/vals</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;:  +&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

        <span class="c1"># Rm alignment</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tab</span><span class="p">:</span>

            <span class="n">table</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tabulate_avrgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Pretty (tabulated) repr of xps &amp; their avrgs.</span>

<span class="sd">        Similar to stats.tabulate_avrgs(), but for the entire list of xps.&quot;&quot;&quot;</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_attrs</span><span class="p">()</span>

        <span class="n">averages</span> <span class="o">=</span> <span class="n">dapper</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">tabulate_avrgs</span><span class="p">([</span><span class="n">C</span><span class="o">.</span><span class="n">avrgs</span> <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">distinct</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">**</span><span class="n">averages</span><span class="p">}</span>  <span class="c1"># merge</span>

        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="s2">&quot;noname&quot;</span><span class="p">,</span> <span class="n">mp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>

               <span class="n">setup</span><span class="o">=</span><span class="n">seed_and_simulate</span><span class="p">,</span> <span class="n">fail_gently</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;For each xp in self: run_experiment(xp, ...).</span>

<span class="sd">        The results are saved in ``rc.dirs[&#39;data&#39;]/save_as.stem``,</span>

<span class="sd">        unless ``save_as`` is False/None.</span>

<span class="sd">        Depending on ``mp``, run_experiment() is delegated to one of:</span>

<span class="sd">         - caller process (no parallelisation)</span>

<span class="sd">         - multiprocessing on this host</span>

<span class="sd">         - GCP (Google Cloud Computing) with HTCondor</span>

<span class="sd">        If ``setup == None``: use ``seed_and_simulate()``.</span>

<span class="sd">        The kwargs are forwarded to run_experiment().</span>

<span class="sd">        See ``example_2.py`` and ``example_3.py`` for example use.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO 2: doc files and code options in mp, e.g</span>

        <span class="c1"># `files` get added to PYTHONPATH and have dir-structure preserved.</span>

        <span class="c1"># Setup: Experiment initialisation. Default: seed_and_simulate().</span>

        <span class="c1">#   Enables setting experiment variables that are not parameters of a da_method.</span>

        <span class="c1"># Collect common args forwarded to run_experiment</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;HMM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HMM</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;setup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">setup</span>

        <span class="c1"># Parse mp option</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mp</span><span class="p">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">mp</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;MP&quot;</span><span class="p">]:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">NPROC</span><span class="o">=</span><span class="n">mp</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mp</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;GCP&quot;</span><span class="p">,</span> <span class="s2">&quot;Google&quot;</span><span class="p">]:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s2">&quot;GCP&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">code</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

        <span class="c1"># Parse fail_gently</span>

        <span class="k">if</span> <span class="n">fail_gently</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;GCP&quot;</span><span class="p">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># coz cloud processing is entirely de-coupled anyways</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># True unless otherwise requested</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;fail_gently&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fail_gently</span>

        <span class="c1"># Parse save_as</span>

        <span class="k">if</span> <span class="n">save_as</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>

            <span class="k">assert</span> <span class="ow">not</span> <span class="n">mp</span><span class="p">,</span> <span class="s2">&quot;Multiprocessing requires saving data.&quot;</span>

            <span class="c1"># Parallelization w/o storing is possible, especially w/ threads.</span>

            <span class="c1"># But it involves more complicated communication set-up.</span>

            <span class="k">def</span> <span class="nf">xpi_dir</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">save_as</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>

            <span class="n">save_as</span> <span class="o">/=</span> <span class="s2">&quot;run_&quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">__%H:%M:%S&quot;</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment stored at </span><span class="si">{</span><span class="n">save_as</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">xpi_dir</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">path</span>

        <span class="c1"># No parallelization</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mp</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_names</span><span class="p">())):</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Local multiprocessing</span>

        <span class="k">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">run_with_fixed_args</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

                <span class="n">xp</span><span class="p">,</span> <span class="n">ixp</span> <span class="o">=</span> <span class="n">arg</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">args</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

            <span class="n">utils</span><span class="o">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="kc">True</span>

            <span class="n">utils</span><span class="o">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">NPROC</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;NPROC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># None =&gt; mp.cpu_count()</span>

            <span class="kn">from</span> <span class="nn">dapper.tools.multiprocessing</span> <span class="kn">import</span> <span class="n">mpd</span>  <span class="c1"># will fail on GCP</span>

            <span class="k">with</span> <span class="n">mpd</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NPROC</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>

                <span class="nb">list</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>

                    <span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>

                        <span class="n">run_with_fixed_args</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span>

                    <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>

                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Parallel experim&#39;s&quot;</span><span class="p">,</span>

                    <span class="n">smoothing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

            <span class="n">utils</span><span class="o">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="kc">False</span>

            <span class="n">utils</span><span class="o">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Google cloud platform, multiprocessing</span>

        <span class="k">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;GCP&quot;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">)</span><span class="o">/</span><span class="s2">&quot;xp.var&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                    <span class="n">dill</span><span class="o">.</span><span class="kp">dump</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">xp</span><span class="o">=</span><span class="n">xp</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s2">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">dill</span><span class="o">.</span><span class="kp">dump</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

            <span class="c1"># mkdir extra_files</span>

            <span class="n">extra_files</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="s2">&quot;extra_files&quot;</span>

            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">extra_files</span><span class="p">)</span>

            <span class="c1"># Default files: .py files in sys.path[0] (main script&#39;s path)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">mp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="p">[]):</span>

                <span class="c1"># Todo 4: also intersect(..., sys.modules).</span>

                <span class="c1"># Todo 4: use git ls-tree instead?</span>

                <span class="n">ff</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)]</span>

            <span class="c1"># Copy files into extra_files</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">mp</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>

                    <span class="c1"># Example: f = &quot;A.py&quot;</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">f</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># instance of tuple(path, root)</span>

                    <span class="c1"># Example: f = (&quot;~/E/G/A.py&quot;, &quot;G&quot;)</span>

                    <span class="n">path</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

                <span class="n">dst</span> <span class="o">=</span> <span class="n">extra_files</span> <span class="o">/</span> <span class="n">dst</span>

                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>

                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="c1"># dir -r</span>

                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>

                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="c1"># file</span>

            <span class="c1"># Loads PWD/xp_{var,com} and calls run_experiment()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s2">&quot;load_and_run.py&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>

<span class="s2">                import dill</span>

<span class="s2">                from dapper.admin import run_experiment</span>

<span class="s2">                # Load</span>

<span class="s2">                with open(&quot;xp.com&quot;, &quot;rb&quot;) as f: com = dill.load(f)</span>

<span class="s2">                with open(&quot;xp.var&quot;, &quot;rb&quot;) as f: var = dill.load(f)</span>

<span class="s2">                # User-defined code</span>

<span class="s2">                </span><span class="si">%s</span><span class="s2"></span>

<span class="s2">                # Run</span>

<span class="s2">                result = run_experiment(var[&#39;xp&#39;], None, &quot;.&quot;, **com)</span>

<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">dedent</span><span class="p">(</span><span class="n">mp</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]))</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s2">&quot;dpr_config.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>

                    <span class="s2">&quot;data_root: &#39;$cwd&#39;&quot;</span><span class="p">,</span>

                    <span class="s2">&quot;liveplotting: no&quot;</span><span class="p">,</span>

                    <span class="s2">&quot;welcome_message: no&quot;</span><span class="p">]))</span>

            <span class="n">submit_job_GCP</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">save_as</span>

<span class="k">def</span> <span class="nf">get_param_setter</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">glob_dict</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Mass creation of xp&#39;s by combining the value lists in the parameter dicts.</span>

<span class="sd">    The parameters are trimmed to the ones available for the given method.</span>

<span class="sd">    This is a good deal more efficient than relying on xpList&#39;s unique=True.</span>

<span class="sd">    Beware! If, eg., [infl,rot] are in the param_dict, aimed at the EnKF,</span>

<span class="sd">    but you forget that they are also attributes some method where you don&#39;t</span>

<span class="sd">    actually want to use them (eg. SVGDF),</span>

<span class="sd">    then you&#39;ll create many more than you intend.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">for_params</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">fixed_params</span><span class="p">):</span>

        <span class="n">dc_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dcs</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">method</span><span class="p">)]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">dc_fields</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">fixed_params</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">glob_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">}</span>  <span class="c1"># glob_dict 1st</span>

        <span class="k">def</span> <span class="nf">xp1</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">dc_fields</span><span class="p">),</span> <span class="o">**</span><span class="n">fixed_params</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">glob_dict</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">xp</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">xp1</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span> <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">prodct</span><span class="p">(</span><span class="n">params</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">for_params</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="da_method">da_method</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">da_method</span><span class="p">(</span>
    <span class="o">*</span><span class="n">default_dataclasses</span>
<span class="p">)</span>
</code></pre></div>

<p>Make the decorator that makes the DA classes.</p>
<p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>@da_method()
class Sleeper():
    "Do nothing."
    seconds : int  = 10
    success : bool = True
    def assimilate(self,<em>args,</em>*kwargs):
        for k in utils.progbar(range(self.seconds)):
            time.sleep(1)
        if not self.success:
            raise RuntimeError("Sleep over. Failing as intended.")</p>
</blockquote>
</blockquote>
</blockquote>
<p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>@dcs.dataclass
class ens_defaults:
  infl : float = 1.0
  rot  : bool  = False</p>
<p>@da_method(ens_defaults)
class EnKF:
    N     : int
    upd_a : str = "Sqrt"</p>
<div class="codehilite"><pre><span></span><code><span class="err">def assimilate(self,HMM,xx,yy):</span>
<span class="err">    ...</span>
</code></pre></div>

</blockquote>
</blockquote>
</blockquote>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">da_method</span><span class="p">(</span><span class="o">*</span><span class="n">default_dataclasses</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Make the decorator that makes the DA classes.</span>

<span class="ss">    Example:</span>

<span class="ss">    &gt;&gt;&gt; @da_method()</span>

<span class="ss">    &gt;&gt;&gt; class Sleeper():</span>

<span class="ss">    &gt;&gt;&gt;     &quot;</span><span class="n">Do</span><span class="w"> </span><span class="n">nothing</span><span class="p">.</span><span class="ss">&quot;</span>

<span class="ss">    &gt;&gt;&gt;     seconds : int  = 10</span>

<span class="ss">    &gt;&gt;&gt;     success : bool = True</span>

<span class="ss">    &gt;&gt;&gt;     def assimilate(self,*args,**kwargs):</span>

<span class="ss">    &gt;&gt;&gt;         for k in utils.progbar(range(self.seconds)):</span>

<span class="ss">    &gt;&gt;&gt;             time.sleep(1)</span>

<span class="ss">    &gt;&gt;&gt;         if not self.success:</span>

<span class="ss">    &gt;&gt;&gt;             raise RuntimeError(&quot;</span><span class="n">Sleep</span><span class="w"> </span><span class="k">over</span><span class="p">.</span><span class="w"> </span><span class="n">Failing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">intended</span><span class="p">.</span><span class="ss">&quot;)</span>

<span class="ss">    Example:</span>

<span class="ss">    &gt;&gt;&gt; @dcs.dataclass</span>

<span class="ss">    &gt;&gt;&gt; class ens_defaults:</span>

<span class="ss">    &gt;&gt;&gt;   infl : float = 1.0</span>

<span class="ss">    &gt;&gt;&gt;   rot  : bool  = False</span>

<span class="ss">    &gt;&gt;&gt;</span>

<span class="ss">    &gt;&gt;&gt; @da_method(ens_defaults)</span>

<span class="ss">    &gt;&gt;&gt; class EnKF:</span>

<span class="ss">    &gt;&gt;&gt;     N     : int</span>

<span class="ss">    &gt;&gt;&gt;     upd_a : str = &quot;</span><span class="nf">Sqrt</span><span class="ss">&quot;</span>

<span class="ss">    &gt;&gt;&gt;</span>

<span class="ss">    &gt;&gt;&gt;     def assimilate(self,HMM,xx,yy):</span>

<span class="ss">    &gt;&gt;&gt;         ...</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">dataclass_with_defaults</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Decorator based on dataclass.</span>

<span class="ss">        This adds __init__, __repr__, __eq__, ..., but also includes</span>

<span class="ss">        inherited defaults (see https://stackoverflow.com/a/58130805 ).</span>

<span class="ss">        Also:</span>

<span class="ss">        - Wraps assimilate() to provide gentle_fail functionality.</span>

<span class="ss">        - Initialises and writes the Stats object.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Default</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="nl">invovle</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">annotations</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">set_field</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__annotations__&#39;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">cls</span><span class="p">.</span><span class="n">__annotations__</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w"></span>

<span class="w">            </span><span class="n">cls</span><span class="p">.</span><span class="n">__annotations__</span><span class="o">[</span><span class="n">name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="w"> </span><span class="n">dcs</span><span class="p">.</span><span class="n">Field</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dcs</span><span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="k">default</span><span class="o">=</span><span class="n">val</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">APPend</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">overwriting</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="p">(</span><span class="k">by</span><span class="w"> </span><span class="n">PREpending</span><span class="vm">?</span><span class="p">)</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="k">default</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">messy</span><span class="err">!</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">default_dataclasses</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nl">NB</span><span class="p">:</span><span class="w"> </span><span class="n">Calling</span><span class="w"> </span><span class="n">dataclass</span><span class="w"> </span><span class="n">twice</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">repr</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dcs</span><span class="p">.</span><span class="n">fields</span><span class="p">(</span><span class="n">dcs</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="nl">__annotations__</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">set_field</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">.</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="p">(</span><span class="nl">NB</span><span class="p">:</span><span class="w"> </span><span class="k">old</span><span class="o">/</span><span class="k">new</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">cls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dcs</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Shortcut</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="w"></span>

<span class="w">        </span><span class="n">cls</span><span class="p">.</span><span class="n">da_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="n">__name__</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">assimilate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">HMM</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">stat_kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Progressbar</span><span class="w"> </span><span class="n">name</span><span class="w"></span>

<span class="w">            </span><span class="n">pb_name_hook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">da_method</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">noqa</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Init</span><span class="w"> </span><span class="n">stats</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dapper</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">HMM</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">stat_kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Assimilate</span><span class="w"></span>

<span class="w">            </span><span class="n">time_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">time</span><span class="p">.</span><span class="nc">time</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">old_assimilate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">HMM</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">dapper</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">register_stat</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;duration&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="p">.</span><span class="nc">time</span><span class="p">()</span><span class="o">-</span><span class="n">time_start</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">old_assimilate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cls</span><span class="p">.</span><span class="n">assimilate</span><span class="w"></span>

<span class="w">        </span><span class="n">cls</span><span class="p">.</span><span class="n">assimilate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">functools</span><span class="p">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">old_assimilate</span><span class="p">)(</span><span class="n">assimilate</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cls</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dataclass_with_defaults</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="get_param_setter">get_param_setter</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_param_setter</span><span class="p">(</span>
    <span class="n">param_dict</span><span class="p">,</span>
    <span class="o">**</span><span class="n">glob_dict</span>
<span class="p">)</span>
</code></pre></div>

<p>Mass creation of xp's by combining the value lists in the parameter dicts.</p>
<p>The parameters are trimmed to the ones available for the given method.
This is a good deal more efficient than relying on xpList's unique=True.</p>
<p>Beware! If, eg., [infl,rot] are in the param_dict, aimed at the EnKF,
but you forget that they are also attributes some method where you don't
actually want to use them (eg. SVGDF),
then you'll create many more than you intend.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">get_param_setter</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">glob_dict</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Mass creation of xp&#39;s by combining the value lists in the parameter dicts.</span>

<span class="sd">    The parameters are trimmed to the ones available for the given method.</span>

<span class="sd">    This is a good deal more efficient than relying on xpList&#39;s unique=True.</span>

<span class="sd">    Beware! If, eg., [infl,rot] are in the param_dict, aimed at the EnKF,</span>

<span class="sd">    but you forget that they are also attributes some method where you don&#39;t</span>

<span class="sd">    actually want to use them (eg. SVGDF),</span>

<span class="sd">    then you&#39;ll create many more than you intend.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">for_params</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">fixed_params</span><span class="p">):</span>

        <span class="n">dc_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dcs</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">method</span><span class="p">)]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">dc_fields</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">complement</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">fixed_params</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">glob_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">}</span>  <span class="c1"># glob_dict 1st</span>

        <span class="n">def</span> <span class="n">xp1</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">dc_fields</span><span class="p">),</span> <span class="o">**</span><span class="n">fixed_params</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">glob_dict</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">setattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">xp</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">xp1</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span> <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">dict_tools</span><span class="o">.</span><span class="n">prodct</span><span class="p">(</span><span class="n">params</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">for_params</span>
</code></pre></div>

</details>
<h3 id="run_experiment">run_experiment</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span>
    <span class="n">xp</span><span class="p">,</span>
    <span class="n">label</span><span class="p">,</span>
    <span class="n">savedir</span><span class="p">,</span>
    <span class="n">HMM</span><span class="p">,</span>
    <span class="n">setup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">free</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">statkeys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fail_gently</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">stat_kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Used by xpList.launch() to run each single experiment.</p>
<p>This involves steps similar to <code>example_1.py</code>, i.e.:</p>
<ul>
<li>setup()                    : Call function given by user. Should set
                               params, eg HMM.Force, seed, and return
                               (simulated/loaded) truth and obs series.</li>
<li>xp.assimilate()            : run DA, pass on exception if fail_gently</li>
<li>xp.stats.average_in_time() : result averaging</li>
<li>xp.avrgs.tabulate()        : result printing</li>
<li>dill.dump()                : result storage</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">savedir</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span>

                   <span class="n">setup</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">free</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">statkeys</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">fail_gently</span><span class="o">=</span><span class="n">False</span><span class="p">,</span>

                   <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Used by xpList.launch() to run each single experiment.</span>

<span class="sd">    This involves steps similar to ``example_1.py``, i.e.:</span>

<span class="sd">    - setup()                    : Call function given by user. Should set</span>

<span class="sd">                                   params, eg HMM.Force, seed, and return</span>

<span class="sd">                                   (simulated/loaded) truth and obs series.</span>

<span class="sd">    - xp.assimilate()            : run DA, pass on exception if fail_gently</span>

<span class="sd">    - xp.stats.average_in_time() : result averaging</span>

<span class="sd">    - xp.avrgs.tabulate()        : result printing</span>

<span class="sd">    - dill.dump()                : result storage</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># We should copy HMM so as not to cause any nasty surprises such as</span>

    <span class="c1"># expecting param=1 when param=2 (coz it&#39;s not been reset).</span>

    <span class="c1"># NB: won&#39;t copy implicitly ref&#39;d obj&#39;s (like L96&#39;s core). =&gt; bug w/ MP?</span>

    <span class="n">hmm</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">HMM</span><span class="p">)</span>

    <span class="c1"># GENERATE TRUTH/OBS</span>

    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span>

    <span class="c1"># ASSIMILATE</span>

    <span class="n">try</span><span class="p">:</span>

        <span class="n">xp</span><span class="o">.</span><span class="n">assimilate</span><span class="p">(</span><span class="n">hmm</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">stat_kwargs</span><span class="p">)</span>

    <span class="n">except</span> <span class="n">Exception</span> <span class="k">as</span> <span class="n">ERR</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">fail_gently</span><span class="p">:</span>

            <span class="n">xp</span><span class="o">.</span><span class="n">crashed</span> <span class="o">=</span> <span class="n">True</span>

            <span class="k">if</span> <span class="n">fail_gently</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="s2">&quot;quiet&quot;</span><span class="p">]:</span>

                <span class="n">utils</span><span class="o">.</span><span class="n">print_cropped_traceback</span><span class="p">(</span><span class="n">ERR</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">raise</span> <span class="n">ERR</span>

    <span class="c1"># AVERAGE</span>

    <span class="n">xp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">average_in_time</span><span class="p">(</span><span class="n">free</span><span class="o">=</span><span class="n">free</span><span class="p">)</span>

    <span class="c1"># PRINT</span>

    <span class="k">if</span> <span class="n">statkeys</span><span class="p">:</span>

        <span class="n">statkeys</span> <span class="o">=</span> <span class="p">()</span> <span class="k">if</span> <span class="n">statkeys</span> <span class="k">is</span> <span class="n">True</span> <span class="k">else</span> <span class="n">statkeys</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">avrgs</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">statkeys</span><span class="p">))</span>

    <span class="c1"># SAVE</span>

    <span class="k">if</span> <span class="n">savedir</span><span class="p">:</span>

        <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span><span class="o">/</span><span class="s2">&quot;xp&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">FILE</span><span class="p">:</span>

            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s1">&#39;xp&#39;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">FILE</span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="seed_and_simulate">seed_and_simulate</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">seed_and_simulate</span><span class="p">(</span>
    <span class="n">HMM</span><span class="p">,</span>
    <span class="n">xp</span>
<span class="p">)</span>
</code></pre></div>

<p>Default experiment setup. Set seed and simulate truth and obs.</p>
<p>Note: if there is no <code>xp.seed</code> then then the seed is not set.
Thus, different experiments will produce different truth and obs.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">seed_and_simulate</span><span class="p">(</span><span class="n">HMM</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>

    <span class="ss">&quot;&quot;&quot;Default experiment setup. Set seed and simulate truth and obs.</span>

<span class="ss">    Note: if there is no ``xp.seed`` then then the seed is not set.</span>

<span class="ss">    Thus, different experiments will produce different truth and obs.&quot;&quot;&quot;</span>

    <span class="n">set_seed</span><span class="p">(</span><span class="n">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="k">False</span><span class="p">))</span>

    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">HMM</span><span class="p">.</span><span class="n">simulate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="hiddenmarkovmodel">HiddenMarkovModel</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HiddenMarkovModel</span><span class="p">(</span>
    <span class="n">Dyn</span><span class="p">,</span>
    <span class="n">Obs</span><span class="p">,</span>
    <span class="n">t</span><span class="p">,</span>
    <span class="n">X0</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Container for attributes of a Hidden Markov Model (HMM).</p>
<p>This container contains the specification of a "twin experiment",
i.e. an "OSSE (observing system simulation experiment)".</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">HiddenMarkovModel</span><span class="p">(</span><span class="n">dict_tools</span><span class="p">.</span><span class="n">NicePrint</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Container for attributes of a Hidden Markov Model (HMM).</span>

<span class="ss">    This container contains the specification of a &quot;</span><span class="n">twin</span><span class="w"> </span><span class="n">experiment</span><span class="ss">&quot;,</span>

<span class="ss">    i.e. an &quot;</span><span class="n">OSSE</span><span class="w"> </span><span class="p">(</span><span class="n">observing</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="n">simulation</span><span class="w"> </span><span class="n">experiment</span><span class="p">)</span><span class="ss">&quot;.</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">X0</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">fmt</span><span class="p">:</span><span class="w"> </span><span class="k">off</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">Dyn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dyn</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">Operator</span><span class="p">)</span><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="n">Operator</span><span class="w">  </span><span class="p">(</span><span class="o">**</span><span class="n">Dyn</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">noqa</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Obs</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">Operator</span><span class="p">)</span><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="n">Operator</span><span class="w">  </span><span class="p">(</span><span class="o">**</span><span class="n">Obs</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">noqa</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">t</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">Chronology</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">Chronology</span><span class="p">(</span><span class="o">**</span><span class="n">t</span><span class="p">)</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="n">noqa</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">X0</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">X0</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">X0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">RV</span><span class="p">)</span><span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="n">RV</span><span class="w">        </span><span class="p">(</span><span class="o">**</span><span class="n">X0</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">noqa</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">fmt</span><span class="p">:</span><span class="w"> </span><span class="k">on</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Name</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="ss">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">name</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inspect</span><span class="p">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="p">.</span><span class="n">stack</span><span class="p">()</span><span class="o">[</span><span class="n">1</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="k">Path</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="n">relative_to</span><span class="p">(</span><span class="n">rc</span><span class="p">.</span><span class="n">dirs</span><span class="p">.</span><span class="n">dapper</span><span class="o">/</span><span class="s1">&#39;mods&#39;</span><span class="p">))</span><span class="w"></span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="nl">ValueError</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str</span><span class="p">(</span><span class="k">Path</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Kwargs</span><span class="w"></span>

<span class="w">        </span><span class="n">abbrevs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="s1">&#39;LP&#39;</span><span class="err">:</span><span class="w"> </span><span class="s1">&#39;liveplotters&#39;</span><span class="err">}</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">kwargs</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">setattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">abbrevs</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">),</span><span class="w"> </span><span class="n">kwargs</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Defaults</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;localizer&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">.</span><span class="n">localizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">no_localization</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">Nx</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Ny</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;sectors&quot;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">sectors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Validation</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">C</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">C</span><span class="p">.</span><span class="n">rk</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">C</span><span class="p">.</span><span class="nl">M</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="ss">&quot;Rank-deficient R not supported.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">ndim</span><span class="w"> </span><span class="n">shortcuts</span><span class="w"></span>

<span class="w">    </span><span class="nv">@property</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">Nx</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Dyn</span><span class="p">.</span><span class="n">M</span><span class="w"></span>

<span class="w">    </span><span class="nv">@property</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">Ny</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">.</span><span class="n">M</span><span class="w"></span>

<span class="w">    </span><span class="n">printopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="s1">&#39;ordering&#39;</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">&#39;Dyn&#39;, &#39;Obs&#39;, &#39;t&#39;, &#39;X0&#39;</span><span class="o">]</span><span class="err">}</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">simulate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="o">=</span><span class="s1">&#39;Truth &amp; Obs&#39;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Generate synthetic truth and observations.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">chrono</span><span class="p">,</span><span class="w"> </span><span class="n">X0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">X0</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Init</span><span class="w"></span>

<span class="w">        </span><span class="n">xx</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="p">.</span><span class="n">K</span><span class="w">   </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Dyn</span><span class="p">.</span><span class="n">M</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">yy</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="p">.</span><span class="n">KObs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Obs</span><span class="p">.</span><span class="n">M</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">xx</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X0</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Loop</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kObs</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">utils</span><span class="p">.</span><span class="n">progbar</span><span class="p">(</span><span class="n">chrono</span><span class="p">.</span><span class="n">ticker</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">xx</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dyn</span><span class="p">(</span><span class="n">xx</span><span class="o">[</span><span class="n">k-1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">Dyn</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">kObs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">yy</span><span class="o">[</span><span class="n">kObs</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Obs</span><span class="p">(</span><span class="n">xx</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Obs</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>dapper.dict_tools.NicePrint</li>
</ul>
<h4 id="class-variables">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">printopts</span>
</code></pre></div>

<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">Nx</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">Ny</span>
</code></pre></div>

<h4 id="methods">Methods</h4>
<h5 id="simulate">simulate</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Truth &amp; Obs&#39;</span>
<span class="p">)</span>
</code></pre></div>

<p>Generate synthetic truth and observations.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">simulate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="o">=</span><span class="s1">&#39;Truth &amp; Obs&#39;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Generate synthetic truth and observations.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">chrono</span><span class="p">,</span><span class="w"> </span><span class="n">X0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Dyn</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">Obs</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">X0</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Init</span><span class="w"></span>

<span class="w">        </span><span class="n">xx</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="p">.</span><span class="n">K</span><span class="w">   </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Dyn</span><span class="p">.</span><span class="n">M</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">yy</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">chrono</span><span class="p">.</span><span class="n">KObs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Obs</span><span class="p">.</span><span class="n">M</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="n">xx</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X0</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Loop</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kObs</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">utils</span><span class="p">.</span><span class="n">progbar</span><span class="p">(</span><span class="n">chrono</span><span class="p">.</span><span class="n">ticker</span><span class="p">,</span><span class="w"> </span><span class="k">desc</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">xx</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dyn</span><span class="p">(</span><span class="n">xx</span><span class="o">[</span><span class="n">k-1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="n">Dyn</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">kObs</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">yy</span><span class="o">[</span><span class="n">kObs</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Obs</span><span class="p">(</span><span class="n">xx</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Obs</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="operator">Operator</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Operator</span><span class="p">(</span>
    <span class="n">M</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Container for operators (models).</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Operator</span><span class="p">(</span><span class="n">dict_tools</span><span class="o">.</span><span class="n">NicePrint</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Container for operators (models).&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">M</span> <span class="o">=</span> <span class="n">M</span>

        <span class="c1"># None =&gt; Identity model</span>

        <span class="k">if</span> <span class="n">model</span> <span class="k">is</span> <span class="n">None</span><span class="p">:</span>

            <span class="n">model</span> <span class="o">=</span> <span class="n">Id_op</span><span class="p">()</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="n">Id_mat</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># None/0 =&gt; No noise</span>

        <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">RV</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">noise</span> <span class="k">is</span> <span class="n">None</span><span class="p">:</span>

                <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">noise</span><span class="p">):</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">GaussRV</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">GaussRV</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>

        <span class="c1"># Write attributes</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">printopts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ordering&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;noise&#39;</span><span class="p">]}</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>dapper.dict_tools.NicePrint</li>
</ul>
<h4 id="class-variables_1">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">printopts</span>
</code></pre></div>

<h3 id="xplist">xpList</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">xpList</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">unique</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>List, subclassed for holding experiment ("xp") objects.</p>
<p>Main use: administrate experiment <strong>launches</strong>.
Also see: <code>xpSpace</code> for experiment <strong>result presentation</strong>.</p>
<p>Modifications to <code>list</code>:</p>
<ul>
<li><code>__iadd__</code> (append) also for single items;
   this is hackey, but convenience is king.</li>
<li><code>append()</code> supports <code>unique</code> to enable lazy xp declaration.</li>
<li><code>__getitem__</code> supports lists.</li>
<li>pretty printing (using common/distinct attrs).</li>
</ul>
<p>Add-ons:</p>
<ul>
<li><code>launch()</code></li>
<li><code>print_averages()</code></li>
<li><code>gen_names()</code></li>
<li><code>inds()</code> to search by kw-attrs.</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nf">xpList</span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="o">:</span>

    <span class="s">&quot;&quot;&quot;List, subclassed for holding experiment (&quot;</span><span class="n">xp</span><span class="s">&quot;) objects.</span>

    <span class="n">Main</span> <span class="nl">use</span><span class="p">:</span> <span class="n">administrate</span> <span class="n">experiment</span> <span class="o">**</span><span class="n">launches</span><span class="o">**</span><span class="p">.</span>

    <span class="n">Also</span> <span class="nl">see</span><span class="p">:</span> <span class="err">``</span><span class="n">xpSpace</span><span class="err">``</span> <span class="k">for</span> <span class="n">experiment</span> <span class="o">**</span><span class="n">result</span> <span class="n">presentation</span><span class="o">**</span><span class="p">.</span>

     <span class="n">Modifications</span> <span class="n">to</span> <span class="err">``</span><span class="n">list</span><span class="err">``</span><span class="o">:</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">__iadd__</span><span class="err">``</span> <span class="p">(</span><span class="n">append</span><span class="p">)</span> <span class="n">also</span> <span class="k">for</span> <span class="n">single</span> <span class="n">items</span><span class="p">;</span>

       <span class="k">this</span> <span class="n">is</span> <span class="n">hackey</span><span class="p">,</span> <span class="n">but</span> <span class="n">convenience</span> <span class="n">is</span> <span class="n">king</span><span class="p">.</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">append</span><span class="p">()</span><span class="err">``</span> <span class="n">supports</span> <span class="err">``</span><span class="n">unique</span><span class="err">``</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">lazy</span> <span class="n">xp</span> <span class="n">declaration</span><span class="p">.</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">__getitem__</span><span class="err">``</span> <span class="n">supports</span> <span class="n">lists</span><span class="p">.</span>

     <span class="o">-</span> <span class="n">pretty</span> <span class="n">printing</span> <span class="p">(</span><span class="k">using</span> <span class="n">common</span><span class="o">/</span><span class="n">distinct</span> <span class="n">attrs</span><span class="p">).</span>

     <span class="n">Add</span><span class="o">-</span><span class="nl">ons</span><span class="p">:</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">launch</span><span class="p">()</span><span class="err">``</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">print_averages</span><span class="p">()</span><span class="err">``</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">gen_names</span><span class="p">()</span><span class="err">``</span>

     <span class="o">-</span> <span class="err">``</span><span class="n">inds</span><span class="p">()</span><span class="err">``</span> <span class="n">to</span> <span class="n">search</span> <span class="n">by</span> <span class="n">kw</span><span class="o">-</span><span class="n">attrs</span><span class="p">.</span>

     <span class="s">&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Initialize without args, or with a list of configs.</span>

        <span class="n">If</span> <span class="err">``</span><span class="n">unique</span><span class="err">``</span><span class="o">:</span> <span class="n">duplicates</span> <span class="n">won</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">get</span> <span class="n">appended</span><span class="p">.</span>

        <span class="n">This</span> <span class="n">makes</span> <span class="err">``</span><span class="n">append</span><span class="p">()</span><span class="err">``</span> <span class="p">(</span><span class="n">and</span> <span class="err">``</span><span class="n">__iadd__</span><span class="p">()</span><span class="err">``</span><span class="p">)</span> <span class="n">relatively</span> <span class="n">slow</span><span class="p">.</span>

        <span class="n">Use</span> <span class="err">``</span><span class="n">extend</span><span class="p">()</span><span class="err">``</span> <span class="n">or</span> <span class="err">``</span><span class="n">__add__</span><span class="p">()</span><span class="err">``</span> <span class="n">to</span> <span class="n">bypass</span> <span class="k">this</span> <span class="n">validation</span><span class="p">.</span><span class="s">&quot;&quot;&quot;</span>

        <span class="n">self</span><span class="p">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>

        <span class="n">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__iadd__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span><span class="o">:</span>

        <span class="k">if</span> <span class="n">not</span> <span class="n">hasattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__iter__</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="p">[</span><span class="n">xp</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">item</span> <span class="n">in</span> <span class="nl">xp</span><span class="p">:</span>

            <span class="n">self</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">self</span>

    <span class="n">def</span> <span class="n">append</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Append if not unique &amp; present.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">not</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">unique</span> <span class="n">and</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">self</span><span class="p">)</span><span class="o">:</span>

            <span class="n">super</span><span class="p">().</span><span class="n">append</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__getitem__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Indexing, also by a list&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="o">:</span>

            <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">keys</span><span class="p">]</span>    <span class="err">#</span> <span class="k">if</span> <span class="n">keys</span> <span class="n">is</span> <span class="n">list</span>

        <span class="n">except</span> <span class="nl">TypeError</span><span class="p">:</span>

            <span class="n">B</span> <span class="o">=</span> <span class="n">super</span><span class="p">().</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>  <span class="err">#</span> <span class="k">if</span> <span class="n">keys</span> <span class="n">is</span> <span class="kt">int</span><span class="p">,</span> <span class="n">slice</span>

        <span class="k">if</span> <span class="n">hasattr</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__len__</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>

            <span class="n">B</span> <span class="o">=</span> <span class="n">xpList</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>                  <span class="err">#</span> <span class="n">Cast</span>

        <span class="k">return</span> <span class="n">B</span>

    <span class="n">def</span> <span class="n">inds</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">missingval</span><span class="o">=</span><span class="s">&quot;NONSENSE&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Find (all) indices of configs whose attributes match kws.</span>

        <span class="n">If</span> <span class="n">strict</span><span class="p">,</span> <span class="n">then</span> <span class="n">xp</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">lacking</span> <span class="n">a</span> <span class="n">requested</span> <span class="n">attr</span> <span class="n">will</span> <span class="n">not</span> <span class="n">match</span><span class="p">,</span>

        <span class="n">unless</span> <span class="n">the</span> <span class="n">missingval</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">None</span><span class="p">)</span> <span class="n">matches</span> <span class="n">the</span> <span class="n">required</span> <span class="n">value</span><span class="p">.</span>

        <span class="s">&quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="n">match</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span><span class="o">:</span>

            <span class="n">def</span> <span class="n">missing</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="k">return</span> <span class="n">missingval</span> <span class="k">if</span> <span class="n">strict</span> <span class="k">else</span> <span class="n">v</span>

            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">missing</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="n">in</span> <span class="n">kws</span><span class="p">.</span><span class="n">items</span><span class="p">()]</span>

            <span class="k">return</span> <span class="n">all</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">xp</span><span class="p">)]</span>

    <span class="err">@</span><span class="n">property</span>

    <span class="n">def</span> <span class="n">da_methods</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">xp</span><span class="p">.</span><span class="n">da_method</span> <span class="k">for</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">self</span><span class="p">]</span>

    <span class="n">def</span> <span class="n">split_attrs</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">nomerge</span><span class="o">=</span><span class="p">())</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Compile the attrs of all xps</span><span class="p">;</span> <span class="n">split</span> <span class="n">as</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span><span class="p">.</span>

        <span class="n">Insert</span> <span class="n">None</span> <span class="k">if</span> <span class="n">an</span> <span class="n">attribute</span> <span class="n">is</span> <span class="n">distinct</span> <span class="n">but</span> <span class="n">not</span> <span class="n">in</span> <span class="n">xp</span><span class="p">.</span><span class="s">&quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="nf">_aggregate_keys</span><span class="p">()</span><span class="o">:</span>

            <span class="s">&quot;Aggregate keys from all xps&quot;</span>

            <span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">:</span>

                <span class="k">return</span> <span class="p">[]</span>

            <span class="cp"># Start with da_method</span>

            <span class="n">aggregate</span> <span class="o">=</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">da_method</span><span class="err">&#39;</span><span class="p">]</span>

            <span class="cp"># Aggregate all other keys</span>

            <span class="k">for</span> <span class="n">xp</span> <span class="n">in</span> <span class="nl">self</span><span class="p">:</span>

                <span class="cp"># Get dataclass fields</span>

                <span class="k">try</span><span class="o">:</span>

                    <span class="n">dc_fields</span> <span class="o">=</span> <span class="n">dcs</span><span class="p">.</span><span class="n">fields</span><span class="p">(</span><span class="n">xp</span><span class="p">.</span><span class="n">__class__</span><span class="p">)</span>

                    <span class="n">dc_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">F</span><span class="p">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">F</span> <span class="n">in</span> <span class="n">dc_fields</span><span class="p">]</span>

                    <span class="n">keys</span> <span class="o">=</span> <span class="n">xp</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>

                <span class="n">except</span> <span class="nl">TypeError</span><span class="p">:</span>

                    <span class="cp"># Assume namedtuple</span>

                    <span class="n">dc_names</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="n">keys</span> <span class="o">=</span> <span class="n">xp</span><span class="p">.</span><span class="n">_fields</span>

                <span class="cp"># For all potential keys:</span>

                <span class="k">for</span> <span class="n">k</span> <span class="n">in</span> <span class="nl">keys</span><span class="p">:</span>

                    <span class="cp"># If not already present:</span>

                    <span class="k">if</span> <span class="n">k</span> <span class="n">not</span> <span class="n">in</span> <span class="nl">aggregate</span><span class="p">:</span>

                        <span class="cp"># If dataclass, check repr:</span>

                        <span class="k">if</span> <span class="n">k</span> <span class="n">in</span> <span class="nl">dc_names</span><span class="p">:</span>

                            <span class="k">if</span> <span class="n">dc_fields</span><span class="p">[</span><span class="n">dc_names</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)].</span><span class="nl">repr</span><span class="p">:</span>

                                <span class="n">aggregate</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

                        <span class="cp"># Else, just append</span>

                        <span class="k">else</span><span class="o">:</span>

                            <span class="n">aggregate</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="cp"># Remove unwanted</span>

            <span class="n">excluded</span>  <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="err">&#39;</span><span class="o">^</span><span class="n">_</span><span class="err">&#39;</span><span class="p">),</span> <span class="err">&#39;</span><span class="n">avrgs</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">stats</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">HMM</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">duration</span><span class="err">&#39;</span><span class="p">]</span>

            <span class="n">aggregate</span> <span class="o">=</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="n">excluded</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">aggregate</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="n">in</span> <span class="n">_aggregate_keys</span><span class="p">()</span><span class="o">:</span>

            <span class="cp"># Want to distinguish actual None&#39;s from empty (&quot;N/A&quot;).</span>

            <span class="cp"># =&gt; Don&#39;t use getattr(obj,key,None)</span>

            <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s">&quot;N/A&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">self</span><span class="p">]</span>

            <span class="cp"># Sort (assign dct) into distinct, redundant, common</span>

            <span class="k">if</span> <span class="n">dict_tools</span><span class="p">.</span><span class="n">flexcomp</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">nomerge</span><span class="p">)</span><span class="o">:</span>

                <span class="cp"># nomerge =&gt; Distinct</span>

                <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">vals</span>

            <span class="n">elif</span> <span class="n">all</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="n">in</span> <span class="n">vals</span><span class="p">)</span><span class="o">:</span>

                <span class="cp"># all values equal =&gt; common</span>

                <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">common</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="o">:</span>

                <span class="n">v0</span> <span class="o">=</span> <span class="n">next</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="n">in</span> <span class="n">vals</span> <span class="k">if</span> <span class="s">&quot;N/A&quot;</span> <span class="o">!=</span> <span class="n">v</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">all</span><span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="s">&quot;N/A&quot;</span> <span class="n">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">v0</span> <span class="k">for</span> <span class="n">v</span> <span class="n">in</span> <span class="n">vals</span><span class="p">)</span><span class="o">:</span>

                    <span class="cp"># all values equal or &quot;N/A&quot; =&gt; redundant</span>

                    <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">v0</span>

                <span class="k">else</span><span class="o">:</span>

                    <span class="cp"># otherwise =&gt; distinct</span>

                    <span class="n">dct</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">vals</span>

            <span class="cp"># Replace &quot;N/A&quot; by None</span>

            <span class="n">def</span> <span class="n">sub</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="k">return</span> <span class="n">None</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&quot;N/A&quot;</span> <span class="k">else</span> <span class="n">v</span>

            <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span><span class="o">:</span>

                <span class="n">vals</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="k">else</span><span class="o">:</span>

                <span class="k">try</span><span class="o">:</span>

                    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">sub</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="n">in</span> <span class="n">vals</span><span class="p">]</span>

                <span class="n">except</span> <span class="nl">TypeError</span><span class="p">:</span>

                    <span class="n">vals</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>

        <span class="k">return</span> <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span>

    <span class="n">def</span> <span class="n">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">split_attrs</span><span class="p">()</span>

        <span class="n">s</span> <span class="o">=</span> <span class="err">&#39;</span><span class="o">&lt;</span><span class="n">xpList</span><span class="o">&gt;</span> <span class="n">of</span> <span class="n">length</span> <span class="nf">%d</span> <span class="n">with</span> <span class="nl">attributes</span><span class="p">:</span><span class="err">\</span><span class="n">n</span><span class="err">&#39;</span> <span class="o">%</span> <span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="n">distinct</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s">&quot;keys&quot;</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Other attributes:</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="n">str</span><span class="p">(</span><span class="n">dict_tools</span><span class="p">.</span><span class="n">AlignedDict</span><span class="p">({</span><span class="o">**</span><span class="n">redundant</span><span class="p">,</span> <span class="o">**</span><span class="n">common</span><span class="p">}))</span>

        <span class="k">return</span> <span class="n">s</span>

    <span class="n">def</span> <span class="n">gen_names</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">abbrev</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Similiar to ``self.__repr__()``, but:</span>

        <span class="o">-</span> <span class="n">returns</span> <span class="o">*</span><span class="n">list</span><span class="o">*</span> <span class="n">of</span> <span class="n">names</span>

        <span class="o">-</span> <span class="n">tabulation</span> <span class="n">is</span> <span class="n">optional</span>

        <span class="o">-</span> <span class="n">attaches</span> <span class="p">(</span><span class="n">abbreviated</span><span class="p">)</span> <span class="n">labels</span> <span class="n">to</span> <span class="n">each</span> <span class="n">attribute</span>

        <span class="s">&quot;&quot;&quot;</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">split_attrs</span><span class="p">(</span><span class="n">nomerge</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;da_method&quot;</span><span class="p">])</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">distinct</span><span class="p">.</span><span class="n">values</span><span class="p">()</span>

        <span class="cp"># Label abbreviation</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="p">.</span><span class="n">collapse_str</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">abbrev</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="n">in</span> <span class="n">labels</span><span class="p">]</span>

        <span class="cp"># Make label columns: insert None or lbl+&quot;:&quot;, depending on value</span>

        <span class="n">def</span> <span class="n">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span><span class="o">:</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">None</span> <span class="k">if</span> <span class="n">v</span> <span class="n">is</span> <span class="n">None</span> <span class="k">else</span> <span class="n">lbl</span><span class="o">+</span><span class="s">&quot;:&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="n">in</span> <span class="n">vals</span><span class="p">]</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)]</span>

        <span class="cp"># Interlace labels and values</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>

        <span class="cp"># Rm da_method label (but keep value)</span>

        <span class="n">table</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="cp"># Transpose</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)))</span>

        <span class="cp"># Tabulate</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;plain&quot;</span><span class="p">)</span>

        <span class="cp"># Rm space between lbls/vals</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="err">&#39;</span><span class="o">:</span>  <span class="o">+</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;:&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

        <span class="cp"># Rm alignment</span>

        <span class="k">if</span> <span class="n">not</span> <span class="nl">tab</span><span class="p">:</span>

            <span class="n">table</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="err">&#39;</span> <span class="o">+</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">r</span><span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">table</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="n">def</span> <span class="n">tabulate_avrgs</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;Pretty (tabulated) repr of xps &amp; their avrgs.</span>

        <span class="n">Similar</span> <span class="n">to</span> <span class="n">stats</span><span class="p">.</span><span class="n">tabulate_avrgs</span><span class="p">(),</span> <span class="n">but</span> <span class="k">for</span> <span class="n">the</span> <span class="n">entire</span> <span class="n">list</span> <span class="n">of</span> <span class="n">xps</span><span class="p">.</span><span class="s">&quot;&quot;&quot;</span>

        <span class="n">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">split_attrs</span><span class="p">()</span>

        <span class="n">averages</span> <span class="o">=</span> <span class="n">dapper</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">tabulate_avrgs</span><span class="p">([</span><span class="n">C</span><span class="p">.</span><span class="n">avrgs</span> <span class="k">for</span> <span class="n">C</span> <span class="n">in</span> <span class="n">self</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">distinct</span><span class="p">,</span> <span class="sc">&#39;|&#39;</span><span class="o">:</span> <span class="p">[</span><span class="sc">&#39;|&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">),</span> <span class="o">**</span><span class="n">averages</span><span class="p">}</span>  <span class="err">#</span> <span class="n">merge</span>

        <span class="k">return</span> <span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s">&quot;keys&quot;</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="n">True</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="sc">&#39;&#39;</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">launch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="s">&quot;noname&quot;</span><span class="p">,</span> <span class="n">mp</span><span class="o">=</span><span class="n">False</span><span class="p">,</span>

               <span class="n">setup</span><span class="o">=</span><span class="n">seed_and_simulate</span><span class="p">,</span> <span class="n">fail_gently</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;For each xp in self: run_experiment(xp, ...).</span>

        <span class="n">The</span> <span class="n">results</span> <span class="n">are</span> <span class="n">saved</span> <span class="n">in</span> <span class="err">``</span><span class="n">rc</span><span class="p">.</span><span class="n">dirs</span><span class="p">[</span><span class="err">&#39;</span><span class="n">data</span><span class="err">&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">save_as</span><span class="p">.</span><span class="n">stem</span><span class="err">``</span><span class="p">,</span>

        <span class="n">unless</span> <span class="err">``</span><span class="n">save_as</span><span class="err">``</span> <span class="n">is</span> <span class="n">False</span><span class="o">/</span><span class="n">None</span><span class="p">.</span>

        <span class="n">Depending</span> <span class="n">on</span> <span class="err">``</span><span class="n">mp</span><span class="err">``</span><span class="p">,</span> <span class="n">run_experiment</span><span class="p">()</span> <span class="n">is</span> <span class="n">delegated</span> <span class="n">to</span> <span class="n">one</span> <span class="nl">of</span><span class="p">:</span>

         <span class="o">-</span> <span class="n">caller</span> <span class="n">process</span> <span class="p">(</span><span class="n">no</span> <span class="n">parallelisation</span><span class="p">)</span>

         <span class="o">-</span> <span class="n">multiprocessing</span> <span class="n">on</span> <span class="k">this</span> <span class="n">host</span>

         <span class="o">-</span> <span class="n">GCP</span> <span class="p">(</span><span class="n">Google</span> <span class="n">Cloud</span> <span class="n">Computing</span><span class="p">)</span> <span class="n">with</span> <span class="n">HTCondor</span>

        <span class="n">If</span> <span class="err">``</span><span class="n">setup</span> <span class="o">==</span> <span class="n">None</span><span class="err">``</span><span class="o">:</span> <span class="n">use</span> <span class="err">``</span><span class="n">seed_and_simulate</span><span class="p">()</span><span class="err">``</span><span class="p">.</span>

        <span class="n">The</span> <span class="n">kwargs</span> <span class="n">are</span> <span class="n">forwarded</span> <span class="n">to</span> <span class="n">run_experiment</span><span class="p">().</span>

        <span class="n">See</span> <span class="err">``</span><span class="n">example_2</span><span class="p">.</span><span class="n">py</span><span class="err">``</span> <span class="n">and</span> <span class="err">``</span><span class="n">example_3</span><span class="p">.</span><span class="n">py</span><span class="err">``</span> <span class="k">for</span> <span class="n">example</span> <span class="n">use</span><span class="p">.</span>

        <span class="s">&quot;&quot;&quot;</span>

        <span class="cp"># TODO 2: doc files and code options in mp, e.g</span>

        <span class="cp"># `files` get added to PYTHONPATH and have dir-structure preserved.</span>

        <span class="cp"># Setup: Experiment initialisation. Default: seed_and_simulate().</span>

        <span class="cp">#   Enables setting experiment variables that are not parameters of a da_method.</span>

        <span class="cp"># Collect common args forwarded to run_experiment</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="err">&#39;</span><span class="n">HMM</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HMM</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;setup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">setup</span>

        <span class="cp"># Parse mp option</span>

        <span class="k">if</span> <span class="n">not</span> <span class="nl">mp</span><span class="p">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">False</span>

        <span class="n">elif</span> <span class="n">mp</span> <span class="n">in</span> <span class="p">[</span><span class="n">True</span><span class="p">,</span> <span class="s">&quot;MP&quot;</span><span class="p">]</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;local&quot;</span><span class="p">)</span>

        <span class="n">elif</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;local&quot;</span><span class="p">,</span> <span class="n">NPROC</span><span class="o">=</span><span class="n">mp</span><span class="p">)</span>

        <span class="n">elif</span> <span class="n">mp</span> <span class="n">in</span> <span class="p">[</span><span class="s">&quot;GCP&quot;</span><span class="p">,</span> <span class="s">&quot;Google&quot;</span><span class="p">]</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;GCP&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">code</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">assert</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">dict</span><span class="p">)</span>

        <span class="cp"># Parse fail_gently</span>

        <span class="k">if</span> <span class="n">fail_gently</span> <span class="n">is</span> <span class="nl">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">dict</span><span class="p">)</span> <span class="n">and</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;GCP&quot;</span><span class="o">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="n">False</span>

                <span class="cp"># coz cloud processing is entirely de-coupled anyways</span>

            <span class="k">else</span><span class="o">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="n">True</span>

                <span class="cp"># True unless otherwise requested</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;fail_gently&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fail_gently</span>

        <span class="cp"># Parse save_as</span>

        <span class="k">if</span> <span class="n">save_as</span> <span class="n">in</span> <span class="p">[</span><span class="n">None</span><span class="p">,</span> <span class="n">False</span><span class="p">]</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">not</span> <span class="n">mp</span><span class="p">,</span> <span class="s">&quot;Multiprocessing requires saving data.&quot;</span>

            <span class="cp"># Parallelization w/o storing is possible, especially w/ threads.</span>

            <span class="cp"># But it involves more complicated communication set-up.</span>

            <span class="n">def</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">:</span> <span class="k">return</span> <span class="n">None</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">save_as</span> <span class="o">=</span> <span class="n">rc</span><span class="p">.</span><span class="n">dirs</span><span class="p">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">).</span><span class="n">stem</span>

            <span class="n">save_as</span> <span class="o">/=</span> <span class="s">&quot;run_&quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-%d__%H:%M:%S&quot;</span><span class="p">)</span>

            <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

            <span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;Experiment stored at {save_as}&quot;</span><span class="p">)</span>

            <span class="n">def</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">:</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">path</span>

        <span class="cp"># No parallelization</span>

        <span class="k">if</span> <span class="n">not</span> <span class="nl">mp</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">zip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">gen_names</span><span class="p">()))</span><span class="o">:</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="cp"># Local multiprocessing</span>

        <span class="n">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;local&quot;</span><span class="o">:</span>

            <span class="n">def</span> <span class="n">run_with_fixed_args</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">:</span>

                <span class="n">xp</span><span class="p">,</span> <span class="n">ixp</span> <span class="o">=</span> <span class="n">arg</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">args</span> <span class="o">=</span> <span class="n">zip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">)))</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="n">True</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="n">True</span>

            <span class="n">NPROC</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;NPROC&quot;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span>  <span class="err">#</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">cpu_count</span><span class="p">()</span>

            <span class="n">from</span> <span class="n">dapper</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">multiprocessing</span> <span class="k">import</span> <span class="n">mpd</span>  <span class="err">#</span> <span class="n">will</span> <span class="n">fail</span> <span class="n">on</span> <span class="n">GCP</span>

            <span class="n">with</span> <span class="n">mpd</span><span class="p">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NPROC</span><span class="p">)</span> <span class="n">as</span> <span class="nl">pool</span><span class="p">:</span>

                <span class="n">list</span><span class="p">(</span><span class="n">utils</span><span class="p">.</span><span class="n">tqdm</span><span class="p">.</span><span class="n">tqdm</span><span class="p">(</span>

                    <span class="n">pool</span><span class="p">.</span><span class="n">imap</span><span class="p">(</span>

                        <span class="n">run_with_fixed_args</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span>

                    <span class="n">total</span><span class="o">=</span><span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">),</span>

                    <span class="n">desc</span><span class="o">=</span><span class="s">&quot;Parallel experim&#39;s&quot;</span><span class="p">,</span>

                    <span class="n">smoothing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="n">False</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="n">False</span>

        <span class="cp"># Google cloud platform, multiprocessing</span>

        <span class="n">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;GCP&quot;</span><span class="o">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">)</span><span class="o">/</span><span class="s">&quot;xp.var&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                    <span class="n">dill</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict</span><span class="p">(</span><span class="n">xp</span><span class="o">=</span><span class="n">xp</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">dill</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

            <span class="cp"># mkdir extra_files</span>

            <span class="n">extra_files</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="s">&quot;extra_files&quot;</span>

            <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">extra_files</span><span class="p">)</span>

            <span class="cp"># Default files: .py files in sys.path[0] (main script&#39;s path)</span>

            <span class="k">if</span> <span class="n">not</span> <span class="n">mp</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">:</span>

                <span class="cp"># Todo 4: also intersect(..., sys.modules).</span>

                <span class="cp"># Todo 4: use git ls-tree instead?</span>

                <span class="n">ff</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">mp</span><span class="p">[</span><span class="s">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="n">in</span> <span class="n">ff</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">)]</span>

            <span class="cp"># Copy files into extra_files</span>

            <span class="k">for</span> <span class="n">f</span> <span class="n">in</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;files&quot;</span><span class="p">]</span><span class="o">:</span>

                <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span><span class="o">:</span>

                    <span class="cp"># Example: f = &quot;A.py&quot;</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">f</span>

                <span class="k">else</span><span class="o">:</span>  <span class="err">#</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

                    <span class="cp"># Example: f = (&quot;~/E/G/A.py&quot;, &quot;G&quot;)</span>

                    <span class="n">path</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

                <span class="n">dst</span> <span class="o">=</span> <span class="n">extra_files</span> <span class="o">/</span> <span class="n">dst</span>

                <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

                <span class="k">try</span><span class="o">:</span>

                    <span class="n">shutil</span><span class="p">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="err">#</span> <span class="n">dir</span> <span class="o">-</span><span class="n">r</span>

                <span class="n">except</span> <span class="nl">OSError</span><span class="p">:</span>

                    <span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="err">#</span> <span class="n">file</span>

            <span class="cp"># Loads PWD/xp_{var,com} and calls run_experiment()</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s">&quot;load_and_run.py&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;\</span>

                <span class="k">import</span> <span class="n">dill</span>

                <span class="n">from</span> <span class="n">dapper</span><span class="p">.</span><span class="n">admin</span> <span class="k">import</span> <span class="n">run_experiment</span>

                <span class="cp"># Load</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span> <span class="n">com</span> <span class="o">=</span> <span class="n">dill</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;xp.var&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span> <span class="n">var</span> <span class="o">=</span> <span class="n">dill</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

                <span class="cp"># User-defined code</span>

                <span class="nf">%s</span>

                <span class="cp"># Run</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="err">&#39;</span><span class="n">xp</span><span class="err">&#39;</span><span class="p">],</span> <span class="n">None</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">com</span><span class="p">)</span>

                <span class="s">&quot;&quot;&quot;) % dedent(mp[&quot;</span><span class="n">code</span><span class="s">&quot;]))</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s">&quot;dpr_config.yaml&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">.</span><span class="n">join</span><span class="p">([</span>

                    <span class="s">&quot;data_root: &#39;$cwd&#39;&quot;</span><span class="p">,</span>

                    <span class="s">&quot;liveplotting: no&quot;</span><span class="p">,</span>

                    <span class="s">&quot;welcome_message: no&quot;</span><span class="p">]))</span>

            <span class="n">submit_job_GCP</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">save_as</span>
</code></pre></div>

</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>builtins.list</li>
</ul>
<h4 id="instance-variables_1">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">da_methods</span>
</code></pre></div>

<h4 id="methods_1">Methods</h4>
<h5 id="append">append</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">append</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">xp</span>
<span class="p">)</span>
</code></pre></div>

<p>Append if not unique &amp; present.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">append</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Append if not unique &amp; present.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="k">not</span> <span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="k">unique</span> <span class="k">and</span> <span class="n">xp</span> <span class="k">in</span> <span class="k">self</span><span class="p">):</span>

            <span class="n">super</span><span class="p">().</span><span class="n">append</span><span class="p">(</span><span class="n">xp</span><span class="p">)</span>
</code></pre></div>

</details>
<h5 id="clear">clear</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove all items from list.</p>
<h5 id="copy">copy</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Return a shallow copy of the list.</p>
<h5 id="count">count</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Return number of occurrences of value.</p>
<h5 id="extend">extend</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">extend</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">iterable</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Extend list by appending elements from the iterable.</p>
<h5 id="gen_names">gen_names</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">gen_names</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">abbrev</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">tab</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>Similiar to <code>self.__repr__()</code>, but:</p>
<ul>
<li>returns <em>list</em> of names</li>
<li>tabulation is optional</li>
<li>attaches (abbreviated) labels to each attribute</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">gen_names</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">abbrev</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">tab</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Similiar to ``self.__repr__()``, but:</span>

<span class="ss">        - returns *list* of names</span>

<span class="ss">        - tabulation is optional</span>

<span class="ss">        - attaches (abbreviated) labels to each attribute</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">split_attrs</span><span class="p">(</span><span class="n">nomerge</span><span class="o">=</span><span class="p">[</span><span class="ss">&quot;da_method&quot;</span><span class="p">])</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="k">distinct</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">values</span> <span class="o">=</span> <span class="k">distinct</span><span class="p">.</span><span class="k">values</span><span class="p">()</span>

        <span class="o">#</span> <span class="n">Label</span> <span class="n">abbreviation</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">utils</span><span class="p">.</span><span class="n">collapse_str</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">abbrev</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="n">labels</span><span class="p">]</span>

        <span class="o">#</span> <span class="n">Make</span> <span class="n">label</span> <span class="n">columns</span><span class="p">:</span> <span class="k">insert</span> <span class="k">None</span> <span class="k">or</span> <span class="n">lbl</span><span class="o">+</span><span class="ss">&quot;:&quot;</span><span class="p">,</span> <span class="n">depending</span> <span class="k">on</span> <span class="n">value</span>

        <span class="n">def</span> <span class="k">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">[</span><span class="k">None</span> <span class="k">if</span> <span class="n">v</span> <span class="k">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">lbl</span><span class="o">+</span><span class="ss">&quot;:&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="k">in</span> <span class="n">vals</span><span class="p">]</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="k">column</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">vals</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="k">values</span><span class="p">)]</span>

        <span class="o">#</span> <span class="n">Interlace</span> <span class="n">labels</span> <span class="k">and</span> <span class="k">values</span>

        <span class="k">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="k">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)]</span>

        <span class="o">#</span> <span class="n">Rm</span> <span class="n">da_method</span> <span class="n">label</span> <span class="p">(</span><span class="n">but</span> <span class="n">keep</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">table</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="o">#</span> <span class="n">Transpose</span>

        <span class="k">table</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="k">map</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="k">table</span><span class="p">)))</span>

        <span class="o">#</span> <span class="n">Tabulate</span>

        <span class="k">table</span> <span class="o">=</span> <span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="k">table</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="ss">&quot;plain&quot;</span><span class="p">)</span>

        <span class="o">#</span> <span class="n">Rm</span> <span class="k">space</span> <span class="k">between</span> <span class="n">lbls</span><span class="o">/</span><span class="n">vals</span>

        <span class="k">table</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;:  +&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="k">table</span><span class="p">)</span>

        <span class="o">#</span> <span class="n">Rm</span> <span class="n">alignment</span>

        <span class="k">if</span> <span class="k">not</span> <span class="n">tab</span><span class="p">:</span>

            <span class="k">table</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="n">r</span><span class="s1">&#39; +&#39;</span><span class="p">,</span> <span class="n">r</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="k">table</span><span class="p">)</span>

        <span class="k">return</span> <span class="k">table</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>
</code></pre></div>

</details>
<h5 id="index">index</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">index</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">stop</span><span class="o">=</span><span class="mi">9223372036854775807</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Return first index of value.</p>
<p>Raises ValueError if the value is not present.</p>
<h5 id="inds">inds</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">inds</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">missingval</span><span class="o">=</span><span class="s1">&#39;NONSENSE&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kws</span>
<span class="p">)</span>
</code></pre></div>

<p>Find (all) indices of configs whose attributes match kws.</p>
<p>If strict, then xp's lacking a requested attr will not match,
unless the missingval (e.g. None) matches the required value.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">inds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">missingval</span><span class="o">=</span><span class="s2">&quot;NONSENSE&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Find (all) indices of configs whose attributes match kws.</span>

<span class="sd">        If strict, then xp&#39;s lacking a requested attr will not match,</span>

<span class="sd">        unless the missingval (e.g. None) matches the required value.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">def</span> <span class="k">match</span><span class="p">(</span><span class="n">xp</span><span class="p">):</span>

            <span class="n">def</span> <span class="n">missing</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="n">missingval</span> <span class="k">if</span> <span class="n">strict</span> <span class="k">else</span> <span class="n">v</span>

            <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">getattr</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">missing</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">==</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kws</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

            <span class="k">return</span> <span class="n">all</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xp</span> <span class="ow">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="k">match</span><span class="p">(</span><span class="n">xp</span><span class="p">)]</span>
</code></pre></div>

</details>
<h5 id="insert">insert</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">index</span><span class="p">,</span>
    <span class="nb">object</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Insert object before index.</p>
<h5 id="launch">launch</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">HMM</span><span class="p">,</span>
    <span class="n">save_as</span><span class="o">=</span><span class="s1">&#39;noname&#39;</span><span class="p">,</span>
    <span class="n">mp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">setup</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">seed_and_simulate</span> <span class="n">at</span> <span class="mh">0x7f8a722404c0</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">fail_gently</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>For each xp in self: run_experiment(xp, ...).</p>
<p>The results are saved in <code>rc.dirs['data']/save_as.stem</code>,
unless <code>save_as</code> is False/None.</p>
<p>Depending on <code>mp</code>, run_experiment() is delegated to one of:
 - caller process (no parallelisation)
 - multiprocessing on this host
 - GCP (Google Cloud Computing) with HTCondor</p>
<p>If <code>setup == None</code>: use <code>seed_and_simulate()</code>.</p>
<p>The kwargs are forwarded to run_experiment().</p>
<p>See <code>example_2.py</code> and <code>example_3.py</code> for example use.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="nf">launch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">HMM</span><span class="p">,</span> <span class="n">save_as</span><span class="o">=</span><span class="s">&quot;noname&quot;</span><span class="p">,</span> <span class="n">mp</span><span class="o">=</span><span class="n">False</span><span class="p">,</span>

               <span class="n">setup</span><span class="o">=</span><span class="n">seed_and_simulate</span><span class="p">,</span> <span class="n">fail_gently</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>

        <span class="s">&quot;&quot;&quot;For each xp in self: run_experiment(xp, ...).</span>

        <span class="n">The</span> <span class="n">results</span> <span class="n">are</span> <span class="n">saved</span> <span class="n">in</span> <span class="err">``</span><span class="n">rc</span><span class="p">.</span><span class="n">dirs</span><span class="p">[</span><span class="err">&#39;</span><span class="n">data</span><span class="err">&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">save_as</span><span class="p">.</span><span class="n">stem</span><span class="err">``</span><span class="p">,</span>

        <span class="n">unless</span> <span class="err">``</span><span class="n">save_as</span><span class="err">``</span> <span class="n">is</span> <span class="n">False</span><span class="o">/</span><span class="n">None</span><span class="p">.</span>

        <span class="n">Depending</span> <span class="n">on</span> <span class="err">``</span><span class="n">mp</span><span class="err">``</span><span class="p">,</span> <span class="n">run_experiment</span><span class="p">()</span> <span class="n">is</span> <span class="n">delegated</span> <span class="n">to</span> <span class="n">one</span> <span class="nl">of</span><span class="p">:</span>

         <span class="o">-</span> <span class="n">caller</span> <span class="n">process</span> <span class="p">(</span><span class="n">no</span> <span class="n">parallelisation</span><span class="p">)</span>

         <span class="o">-</span> <span class="n">multiprocessing</span> <span class="n">on</span> <span class="k">this</span> <span class="n">host</span>

         <span class="o">-</span> <span class="n">GCP</span> <span class="p">(</span><span class="n">Google</span> <span class="n">Cloud</span> <span class="n">Computing</span><span class="p">)</span> <span class="n">with</span> <span class="n">HTCondor</span>

        <span class="n">If</span> <span class="err">``</span><span class="n">setup</span> <span class="o">==</span> <span class="n">None</span><span class="err">``</span><span class="o">:</span> <span class="n">use</span> <span class="err">``</span><span class="n">seed_and_simulate</span><span class="p">()</span><span class="err">``</span><span class="p">.</span>

        <span class="n">The</span> <span class="n">kwargs</span> <span class="n">are</span> <span class="n">forwarded</span> <span class="n">to</span> <span class="n">run_experiment</span><span class="p">().</span>

        <span class="n">See</span> <span class="err">``</span><span class="n">example_2</span><span class="p">.</span><span class="n">py</span><span class="err">``</span> <span class="n">and</span> <span class="err">``</span><span class="n">example_3</span><span class="p">.</span><span class="n">py</span><span class="err">``</span> <span class="k">for</span> <span class="n">example</span> <span class="n">use</span><span class="p">.</span>

        <span class="s">&quot;&quot;&quot;</span>

        <span class="cp"># TODO 2: doc files and code options in mp, e.g</span>

        <span class="cp"># `files` get added to PYTHONPATH and have dir-structure preserved.</span>

        <span class="cp"># Setup: Experiment initialisation. Default: seed_and_simulate().</span>

        <span class="cp">#   Enables setting experiment variables that are not parameters of a da_method.</span>

        <span class="cp"># Collect common args forwarded to run_experiment</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="err">&#39;</span><span class="n">HMM</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HMM</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;setup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">setup</span>

        <span class="cp"># Parse mp option</span>

        <span class="k">if</span> <span class="n">not</span> <span class="nl">mp</span><span class="p">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">False</span>

        <span class="n">elif</span> <span class="n">mp</span> <span class="n">in</span> <span class="p">[</span><span class="n">True</span><span class="p">,</span> <span class="s">&quot;MP&quot;</span><span class="p">]</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;local&quot;</span><span class="p">)</span>

        <span class="n">elif</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;local&quot;</span><span class="p">,</span> <span class="n">NPROC</span><span class="o">=</span><span class="n">mp</span><span class="p">)</span>

        <span class="n">elif</span> <span class="n">mp</span> <span class="n">in</span> <span class="p">[</span><span class="s">&quot;GCP&quot;</span><span class="p">,</span> <span class="s">&quot;Google&quot;</span><span class="p">]</span><span class="o">:</span>

            <span class="n">mp</span> <span class="o">=</span> <span class="n">dict</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s">&quot;GCP&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">code</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">assert</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">dict</span><span class="p">)</span>

        <span class="cp"># Parse fail_gently</span>

        <span class="k">if</span> <span class="n">fail_gently</span> <span class="n">is</span> <span class="nl">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">dict</span><span class="p">)</span> <span class="n">and</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;GCP&quot;</span><span class="o">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="n">False</span>

                <span class="cp"># coz cloud processing is entirely de-coupled anyways</span>

            <span class="k">else</span><span class="o">:</span>

                <span class="n">fail_gently</span> <span class="o">=</span> <span class="n">True</span>

                <span class="cp"># True unless otherwise requested</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&quot;fail_gently&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fail_gently</span>

        <span class="cp"># Parse save_as</span>

        <span class="k">if</span> <span class="n">save_as</span> <span class="n">in</span> <span class="p">[</span><span class="n">None</span><span class="p">,</span> <span class="n">False</span><span class="p">]</span><span class="o">:</span>

            <span class="n">assert</span> <span class="n">not</span> <span class="n">mp</span><span class="p">,</span> <span class="s">&quot;Multiprocessing requires saving data.&quot;</span>

            <span class="cp"># Parallelization w/o storing is possible, especially w/ threads.</span>

            <span class="cp"># But it involves more complicated communication set-up.</span>

            <span class="n">def</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">:</span> <span class="k">return</span> <span class="n">None</span>

        <span class="k">else</span><span class="o">:</span>

            <span class="n">save_as</span> <span class="o">=</span> <span class="n">rc</span><span class="p">.</span><span class="n">dirs</span><span class="p">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_as</span><span class="p">).</span><span class="n">stem</span>

            <span class="n">save_as</span> <span class="o">/=</span> <span class="s">&quot;run_&quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-%d__%H:%M:%S&quot;</span><span class="p">)</span>

            <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

            <span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;Experiment stored at </span><span class="p">{</span><span class="n">save_as</span><span class="p">}</span><span class="s">&quot;)</span>

            <span class="n">def</span> <span class="nf">xpi_dir</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">:</span>

                <span class="n">path</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">path</span>

        <span class="cp"># No parallelization</span>

        <span class="k">if</span> <span class="n">not</span> <span class="nl">mp</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">zip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">gen_names</span><span class="p">()))</span><span class="o">:</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="cp"># Local multiprocessing</span>

        <span class="n">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;local&quot;</span><span class="o">:</span>

            <span class="n">def</span> <span class="n">run_with_fixed_args</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">:</span>

                <span class="n">xp</span><span class="p">,</span> <span class="n">ixp</span> <span class="o">=</span> <span class="n">arg</span>

                <span class="n">run_experiment</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">args</span> <span class="o">=</span> <span class="n">zip</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">)))</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="n">True</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="n">True</span>

            <span class="n">NPROC</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;NPROC&quot;</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span>  <span class="err">#</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">mp</span><span class="p">.</span><span class="n">cpu_count</span><span class="p">()</span>

            <span class="n">from</span> <span class="n">dapper</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">multiprocessing</span> <span class="k">import</span> <span class="n">mpd</span>  <span class="err">#</span> <span class="n">will</span> <span class="n">fail</span> <span class="n">on</span> <span class="n">GCP</span>

            <span class="n">with</span> <span class="n">mpd</span><span class="p">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">NPROC</span><span class="p">)</span> <span class="n">as</span> <span class="nl">pool</span><span class="p">:</span>

                <span class="n">list</span><span class="p">(</span><span class="n">utils</span><span class="p">.</span><span class="n">tqdm</span><span class="p">.</span><span class="n">tqdm</span><span class="p">(</span>

                    <span class="n">pool</span><span class="p">.</span><span class="n">imap</span><span class="p">(</span>

                        <span class="n">run_with_fixed_args</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span>

                    <span class="n">total</span><span class="o">=</span><span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">),</span>

                    <span class="n">desc</span><span class="o">=</span><span class="s">&quot;Parallel experim&#39;s&quot;</span><span class="p">,</span>

                    <span class="n">smoothing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_progbar</span>          <span class="o">=</span> <span class="n">False</span>

            <span class="n">utils</span><span class="p">.</span><span class="n">disable_user_interaction</span> <span class="o">=</span> <span class="n">False</span>

        <span class="cp"># Google cloud platform, multiprocessing</span>

        <span class="n">elif</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;server&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;GCP&quot;</span><span class="o">:</span>

            <span class="k">for</span> <span class="n">ixp</span><span class="p">,</span> <span class="n">xp</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">xpi_dir</span><span class="p">(</span><span class="n">ixp</span><span class="p">)</span><span class="o">/</span><span class="s">&quot;xp.var&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                    <span class="n">dill</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict</span><span class="p">(</span><span class="n">xp</span><span class="o">=</span><span class="n">xp</span><span class="p">),</span> <span class="n">f</span><span class="p">)</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">save_as</span><span class="o">/</span><span class="s">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">dill</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

            <span class="cp"># mkdir extra_files</span>

            <span class="n">extra_files</span> <span class="o">=</span> <span class="n">save_as</span> <span class="o">/</span> <span class="s">&quot;extra_files&quot;</span>

            <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">extra_files</span><span class="p">)</span>

            <span class="cp"># Default files: .py files in sys.path[0] (main script&#39;s path)</span>

            <span class="k">if</span> <span class="n">not</span> <span class="n">mp</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">:</span>

                <span class="cp"># Todo 4: also intersect(..., sys.modules).</span>

                <span class="cp"># Todo 4: use git ls-tree instead?</span>

                <span class="n">ff</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">mp</span><span class="p">[</span><span class="s">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="n">in</span> <span class="n">ff</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">)]</span>

            <span class="cp"># Copy files into extra_files</span>

            <span class="k">for</span> <span class="n">f</span> <span class="n">in</span> <span class="n">mp</span><span class="p">[</span><span class="s">&quot;files&quot;</span><span class="p">]</span><span class="o">:</span>

                <span class="k">if</span> <span class="n">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span><span class="o">:</span>

                    <span class="cp"># Example: f = &quot;A.py&quot;</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">f</span>

                <span class="k">else</span><span class="o">:</span>  <span class="err">#</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

                    <span class="cp"># Example: f = (&quot;~/E/G/A.py&quot;, &quot;G&quot;)</span>

                    <span class="n">path</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">f</span>

                    <span class="n">dst</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

                <span class="n">dst</span> <span class="o">=</span> <span class="n">extra_files</span> <span class="o">/</span> <span class="n">dst</span>

                <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

                <span class="k">try</span><span class="o">:</span>

                    <span class="n">shutil</span><span class="p">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="err">#</span> <span class="n">dir</span> <span class="o">-</span><span class="n">r</span>

                <span class="n">except</span> <span class="nl">OSError</span><span class="p">:</span>

                    <span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>  <span class="err">#</span> <span class="n">file</span>

            <span class="cp"># Loads PWD/xp_</span><span class="p">{</span><span class="n">var</span><span class="p">,</span><span class="n">com</span><span class="p">}</span> <span class="n">and</span> <span class="n">calls</span> <span class="n">run_experiment</span><span class="p">()</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s">&quot;load_and_run.py&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">dedent</span><span class="p">(</span><span class="s">&quot;&quot;&quot;\</span>

                <span class="k">import</span> <span class="n">dill</span>

                <span class="n">from</span> <span class="n">dapper</span><span class="p">.</span><span class="n">admin</span> <span class="k">import</span> <span class="n">run_experiment</span>

                <span class="cp"># Load</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;xp.com&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span> <span class="n">com</span> <span class="o">=</span> <span class="n">dill</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

                <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="s">&quot;xp.var&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span> <span class="n">var</span> <span class="o">=</span> <span class="n">dill</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

                <span class="cp"># User-defined code</span>

                <span class="nf">%s</span>

                <span class="cp"># Run</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="err">&#39;</span><span class="n">xp</span><span class="err">&#39;</span><span class="p">],</span> <span class="n">None</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">com</span><span class="p">)</span>

                <span class="s">&quot;&quot;&quot;) % dedent(mp[&quot;</span><span class="n">code</span><span class="s">&quot;]))</span>

            <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="n">extra_files</span><span class="o">/</span><span class="s">&quot;dpr_config.yaml&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f</span><span class="p">:</span>

                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">.</span><span class="n">join</span><span class="p">([</span>

                    <span class="s">&quot;data_root: &#39;$cwd&#39;&quot;</span><span class="p">,</span>

                    <span class="s">&quot;liveplotting: no&quot;</span><span class="p">,</span>

                    <span class="s">&quot;welcome_message: no&quot;</span><span class="p">]))</span>

            <span class="n">submit_job_GCP</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">save_as</span>
</code></pre></div>

</details>
<h5 id="pop">pop</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove and return item at index (default last).</p>
<p>Raises IndexError if list is empty or index is out of range.</p>
<h5 id="remove">remove</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Remove first occurrence of value.</p>
<p>Raises ValueError if the value is not present.</p>
<h5 id="reverse">reverse</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span>
<span class="p">)</span>
</code></pre></div>

<p>Reverse <em>IN PLACE</em>.</p>
<h5 id="sort">sort</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">sort</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>

<p>Sort the list in ascending order and return None.</p>
<p>The sort is in-place (i.e. the list itself is modified) and stable (i.e. the
order of two equal elements is maintained).</p>
<p>If a key function is given, apply it once to each list item and sort them,
ascending or descending, according to their function values.</p>
<p>The reverse flag can be set to sort in descending order.</p>
<h5 id="split_attrs">split_attrs</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">split_attrs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nomerge</span><span class="o">=</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>

<p>Compile the attrs of all xps; split as distinct, redundant, common.</p>
<p>Insert None if an attribute is distinct but not in xp.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">split_attrs</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">nomerge</span><span class="o">=</span><span class="p">())</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Compile the attrs of all xps; split as distinct, redundant, common.</span>

<span class="ss">        Insert None if an attribute is distinct but not in xp.&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">_aggregate_keys</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="ss">&quot;Aggregate keys from all xps&quot;</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Start</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">da_method</span><span class="w"></span>

<span class="w">            </span><span class="k">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&#39;da_method&#39;</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Aggregate</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">keys</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">xp</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">self</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="k">Get</span><span class="w"> </span><span class="n">dataclass</span><span class="w"> </span><span class="n">fields</span><span class="w"></span>

<span class="w">                </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">dc_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dcs</span><span class="p">.</span><span class="n">fields</span><span class="p">(</span><span class="n">xp</span><span class="p">.</span><span class="n">__class__</span><span class="p">)</span><span class="w"></span>

<span class="w">                    </span><span class="n">dc_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">F.name for F in dc_fields</span><span class="o">]</span><span class="w"></span>

<span class="w">                    </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xp</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span><span class="w"></span>

<span class="w">                </span><span class="ow">except</span><span class="w"> </span><span class="nl">TypeError</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">Assume</span><span class="w"> </span><span class="n">namedtuple</span><span class="w"></span>

<span class="w">                    </span><span class="n">dc_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">                    </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xp</span><span class="p">.</span><span class="n">_fields</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">potential</span><span class="w"> </span><span class="nl">keys</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">keys</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="nl">present</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">aggregate</span><span class="err">:</span><span class="w"></span>

<span class="w">                        </span><span class="err">#</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">dataclass</span><span class="p">,</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="nl">repr</span><span class="p">:</span><span class="w"></span>

<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">dc_names</span><span class="p">:</span><span class="w"></span>

<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="n">dc_fields</span><span class="o">[</span><span class="n">dc_names.index(k)</span><span class="o">]</span><span class="p">.</span><span class="nl">repr</span><span class="p">:</span><span class="w"></span>

<span class="w">                                </span><span class="k">aggregate</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>

<span class="w">                        </span><span class="err">#</span><span class="w"> </span><span class="k">Else</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">append</span><span class="w"></span>

<span class="w">                        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                            </span><span class="k">aggregate</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Remove</span><span class="w"> </span><span class="n">unwanted</span><span class="w"></span>

<span class="w">            </span><span class="n">excluded</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">re.compile(&#39;^_&#39;), &#39;avrgs&#39;, &#39;stats&#39;, &#39;HMM&#39;, &#39;duration&#39;</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">complement</span><span class="p">(</span><span class="k">aggregate</span><span class="p">,</span><span class="w"> </span><span class="n">excluded</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">aggregate</span><span class="w"></span>

<span class="w">        </span><span class="k">distinct</span><span class="p">,</span><span class="w"> </span><span class="n">redundant</span><span class="p">,</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span><span class="err">{}</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">_aggregate_keys</span><span class="p">()</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">distinguish</span><span class="w"> </span><span class="n">actual</span><span class="w"> </span><span class="k">None</span><span class="s1">&#39;s from empty (&quot;N/A&quot;).</span>

<span class="s1">            # =&gt; Don&#39;</span><span class="n">t</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="k">key</span><span class="p">,</span><span class="k">None</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">getattr(xp, key, &quot;N/A&quot;) for xp in self</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Sort</span><span class="w"> </span><span class="p">(</span><span class="n">assign</span><span class="w"> </span><span class="n">dct</span><span class="p">)</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="k">distinct</span><span class="p">,</span><span class="w"> </span><span class="n">redundant</span><span class="p">,</span><span class="w"> </span><span class="n">common</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">dict_tools</span><span class="p">.</span><span class="n">flexcomp</span><span class="p">(</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">nomerge</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="n">nomerge</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">Distinct</span><span class="w"></span>

<span class="w">                </span><span class="n">dct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">distinct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"></span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="ow">all</span><span class="p">(</span><span class="n">vals</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">vals</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="err">#</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">common</span><span class="w"></span>

<span class="w">                </span><span class="n">dct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">next</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">&quot;N/A&quot;</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="ow">all</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;N/A&quot;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">v0</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">vals</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">equal</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ss">&quot;N/A&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">redundant</span><span class="w"></span>

<span class="w">                    </span><span class="n">dct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">redundant</span><span class="p">,</span><span class="w"> </span><span class="n">v0</span><span class="w"></span>

<span class="w">                </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="err">#</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">distinct</span><span class="w"></span>

<span class="w">                    </span><span class="n">dct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">distinct</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nf">Replace</span><span class="w"> </span><span class="ss">&quot;N/A&quot;</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">            </span><span class="n">def</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;N/A&quot;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">v</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">sub(v) for v in vals</span><span class="o">]</span><span class="w"></span>

<span class="w">                </span><span class="ow">except</span><span class="w"> </span><span class="nl">TypeError</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">dct</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vals</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">distinct</span><span class="p">,</span><span class="w"> </span><span class="n">redundant</span><span class="p">,</span><span class="w"> </span><span class="n">common</span><span class="w"></span>
</code></pre></div>

</details>
<h5 id="tabulate_avrgs">tabulate_avrgs</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tabulate_avrgs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<p>Pretty (tabulated) repr of xps &amp; their avrgs.</p>
<p>Similar to stats.tabulate_avrgs(), but for the entire list of xps.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">tabulate_avrgs</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="ss">&quot;&quot;&quot;Pretty (tabulated) repr of xps &amp; their avrgs.</span>

<span class="ss">        Similar to stats.tabulate_avrgs(), but for the entire list of xps.&quot;&quot;&quot;</span>

        <span class="k">distinct</span><span class="p">,</span> <span class="n">redundant</span><span class="p">,</span> <span class="n">common</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">split_attrs</span><span class="p">()</span>

        <span class="n">averages</span> <span class="o">=</span> <span class="n">dapper</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">tabulate_avrgs</span><span class="p">([</span><span class="k">C</span><span class="p">.</span><span class="n">avrgs</span> <span class="k">for</span> <span class="k">C</span> <span class="k">in</span> <span class="k">self</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="err">{</span><span class="o">**</span><span class="k">distinct</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">len</span><span class="p">(</span><span class="k">self</span><span class="p">),</span> <span class="o">**</span><span class="n">averages</span><span class="err">}</span>  <span class="o">#</span> <span class="n">merge</span>

        <span class="k">return</span> <span class="n">utils</span><span class="p">.</span><span class="n">tab</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="ss">&quot;keys&quot;</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="k">True</span><span class="p">).</span><span class="k">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../data_management/" title="Data Management" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Data Management
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>